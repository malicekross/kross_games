import"./modulepreload-polyfill-B5Qt9EMX.js";import{b as T,g as M,T as u,R as g,e as N,c as E,k as f,f as m,A as V}from"./index-C9Gq2ce5.js";const x=32,I=24,v=16,h=x*I,d=x*v,a={BACKGROUND:1710618,UI_BG:0,UI_BORDER:65280,TEXT:65280},C={INTRO:"INTRO",VAULT:"VAULT",WAR:"WAR"},c={DIRT:0,ROCK:1,BEDROCK:2,EMPTY:3,ROOM:4};class ${constructor(t,e){this.app=t,this.container=new T,this.tiles=[],this.sprites=[],e.addChild(this.container),this.textureBase=M.get("tiles"),this.textureBase||(console.error("Tiles texture not found in cache!"),this.textureBase=u.EMPTY),this.textures={[c.DIRT]:[],[c.ROCK]:[],[c.BEDROCK]:[],[c.EMPTY]:[]},this._initTextures(),this._initGrid()}_initTextures(){for(let t=0;t<5;t++)this.textures[c.DIRT].push(new u({source:this.textureBase.source,frame:new g(t*32,0,32,32)})),this.textures[c.ROCK].push(new u({source:this.textureBase.source,frame:new g(t*32,32,32,32)})),this.textures[c.BEDROCK].push(new u({source:this.textureBase.source,frame:new g(t*32,64,32,32)})),this.textures[c.EMPTY].push(new u({source:this.textureBase.source,frame:new g(t*32,96,32,32)}))}_initGrid(){for(let t=0;t<v;t++){this.tiles[t]=[],this.sprites[t]=[];for(let e=0;e<I;e++){let s=c.DIRT;t===v-1?s=c.BEDROCK:Math.random()<.1&&(s=c.ROCK),t===0&&(s=c.EMPTY),t===2&&e>=2&&e<=5&&(s=c.EMPTY),this.tiles[t][e]={type:s,room:null};const i=new N(this._getRandomTexture(s));i.x=e*x,i.y=t*x,i.eventMode="static",i.on("pointerdown",()=>this.onTileClick(e,t)),this.container.addChild(i),this.sprites[t][e]=i}}}onTileClick(t,e){console.log(`Clicked tile ${t}, ${e}`)}_getRandomTexture(t){const e=this.textures[t];return!e||e.length===0?u.EMPTY:t===c.DIRT?e[0]:e[Math.floor(Math.random()*e.length)]}dig(t,e){if(t<0||t>=I||e<0||e>=v)return!1;const s=this.tiles[e][t];return s.type===c.BEDROCK||s.type===c.EMPTY||s.type===c.ROOM||e<2||e>=v-2?!1:(s.type=c.EMPTY,this.sprites[e][t].texture=this._getRandomTexture(c.EMPTY),!0)}buildRoom(t,e,s){if(t<0||t>=I||e<0||e>=v)return!1;const i=this.tiles[e][t];if(i.type!==c.EMPTY)return!1;i.type=c.ROOM,i.room=s;const n=M.get("rooms");return n&&(this.sprites[e][t].texture=n),!0}getTile(t,e){return t<0||t>=I||e<0||e>=v?null:this.tiles[e][t]}}const O={LIVING_QUARTERS:"LIVING_QUARTERS",POWER_PLANT:"POWER_PLANT",DINER:"DINER",WATER_TREATMENT:"WATER_TREATMENT",ARMORY:"ARMORY",MEDBAY:"MEDBAY",WORKSHOP:"WORKSHOP"},k={[O.LIVING_QUARTERS]:100,[O.POWER_PLANT]:150,[O.DINER]:150,[O.WATER_TREATMENT]:150,[O.ARMORY]:200,[O.MEDBAY]:300,[O.WORKSHOP]:500};class Y{constructor(t){this.gridSystem=t}findPath(t,e,s,i){const n={x:t,y:e,g:0,h:0,f:0,parent:null},o={x:s,y:i},l=[n],p=[];for(;l.length>0;){let r=l[0],D=0;for(let R=1;R<l.length;R++)l[R].f<r.f&&(r=l[R],D=R);if(l.splice(D,1),p.push(r),r.x===o.x&&r.y===o.y){const R=[];let S=r;for(;S!==null;)R.push({x:S.x,y:S.y}),S=S.parent;return R.reverse()}const _=[{x:0,y:-1},{x:0,y:1},{x:-1,y:0},{x:1,y:0}];for(const R of _){const S=r.x+R.x,b=r.y+R.y;if(S<0||S>=I||b<0||b>=v||b<2||b>=v-2)continue;const U=this.gridSystem.getTile(S,b);if(!U||!(S===s&&b===i)&&U.type!==c.EMPTY&&U.type!==c.ROOM||p.find(B=>B.x===S&&B.y===b))continue;const W=r.g+1,P=Math.abs(S-o.x)+Math.abs(b-o.y),F=W+P,H={x:S,y:b,g:W,h:P,f:F,parent:r},G=l.find(B=>B.x===S&&B.y===b);G&&W>G.g||l.push(H)}}return null}}const A={IDLE:"IDLE",DIG:"DIG",BUILD:"BUILD"};class X{constructor(t,e,s){this.app=t,this.gridSystem=e,this.pathfinder=s,this.container=new T,this.dwellers=[],this.mrHandys=[],this.jobs=[],this.textureBase=M.get("dwellers"),this.mrHandyTextureBase=M.get("mr_handy"),this.textureBase||(this.textureBase=u.EMPTY),this.mrHandyTextureBase||(this.mrHandyTextureBase=u.EMPTY),this.dwellerTextures=[];for(let i=0;i<5;i++)this.dwellerTextures.push(new u({source:this.textureBase.source,frame:new g(i*32,0,32,32)}));this.mrHandyIdleTexture=new u({source:this.mrHandyTextureBase.source,frame:new g(0,0,32,32)}),this.baseSpeed=2,this.workSpeed=1}setStats(t,e){this.baseSpeed=t,this.workSpeed=e;for(const s of this.dwellers)s.speed=this.baseSpeed}spawnDweller(t,e){const s=this.dwellerTextures[Math.floor(Math.random()*this.dwellerTextures.length)],i={sprite:new N(s),x:t,y:e,state:A.IDLE,path:[],targetJob:null,speed:this.baseSpeed,isRobot:!1};i.sprite.x=t*x,i.sprite.y=e*x,this.container.addChild(i.sprite),this.dwellers.push(i)}spawnMrHandy(t,e){if(this.mrHandys.length>=4)return;const s={sprite:new N(this.mrHandyIdleTexture),x:t,y:e,state:A.IDLE,path:[],targetJob:null,speed:4,isRobot:!0};s.sprite.x=t*x,s.sprite.y=e*x,this.container.addChild(s.sprite),this.mrHandys.push(s)}addJob(t,e,s,i={}){this.jobs.push({type:t,x:e,y:s,priority:1,data:i})}update(t){for(const e of this.dwellers)this._updateDweller(e,t);for(const e of this.mrHandys)this._updateDweller(e,t)}_updateDweller(t,e){if(t.state===A.IDLE&&this.jobs.length>0){const s=this.jobs.shift(),i=Math.floor(t.sprite.x/x),n=Math.floor(t.sprite.y/x),o=this.pathfinder.findPath(i,n,s.x,s.y);o?(t.state=s.type,t.targetJob=s,t.path=o):this.jobs.push(s)}if(t.path.length>0){const s=t.path[0],i=s.x*x,n=s.y*x,o=i-t.sprite.x,l=n-t.sprite.y,p=Math.sqrt(o*o+l*l);p<t.speed*e?(t.sprite.x=i,t.sprite.y=n,t.path.shift()):(t.sprite.x+=o/p*t.speed*e,t.sprite.y+=l/p*t.speed*e)}else t.targetJob&&this._performJob(t,e)}_performJob(t,e){const s=t.targetJob;t.jobTimer||(s.type===A.DIG?t.jobTimer=2e3:s.type===A.BUILD?t.jobTimer=4e3:t.jobTimer=0),t.jobTimer-=e*16.66,t.jobTimer<=0&&(s.type===A.DIG&&this.gridSystem.dig(s.x,s.y),t.state=A.IDLE,t.targetJob=null,t.jobTimer=null)}}class K{constructor(t){this.game=t,this.day=1,this.time=0,this.dayDuration=60,this.isWarMode=!1}update(t){this.isWarMode||(this.time+=t/60/this.dayDuration,this.time>=1&&this.endDay())}endDay(){this.time=0,this.day++,console.log(`Day ${this.day} Started`),this.game.onNewDay(this.day)}advanceDay(){this.endDay()}}const L={SCOUT:"SCOUT",SOLDIER:"SOLDIER",BRUTE:"BRUTE",POWER_ARMOR:"POWER_ARMOR"},y={RADROACH:"RADROACH",MOLE_RAT:"MOLE_RAT",GHOUL:"GHOUL",RAIDER_SCUM:"RAIDER_SCUM",RAIDER_PSYCHO:"RAIDER_PSYCHO",SUPER_MUTANT:"SUPER_MUTANT",DEATHCLAW:"DEATHCLAW"};class z{constructor(t){this.app=t,this.container=new T,this.units=[],this.enemies=[],this.projectiles=[],this.isActive=!1,this.unitTextureBase=M.get("combat_units"),this.enemyTextureBase=M.get("enemies"),this.unitTextureBase||(this.unitTextureBase=u.EMPTY),this.enemyTextureBase||(this.enemyTextureBase=u.EMPTY),this.textures={[L.SCOUT]:new u({source:this.unitTextureBase.source,frame:new g(0,0,32,32)}),[y.RADROACH]:new u({source:this.enemyTextureBase.source,frame:new g(0,0,32,32)}),[y.MOLE_RAT]:new u({source:this.enemyTextureBase.source,frame:new g(0,32,32,32)}),[y.GHOUL]:new u({source:this.enemyTextureBase.source,frame:new g(0,64,32,32)}),[y.RAIDER_SCUM]:new u({source:this.enemyTextureBase.source,frame:new g(0,96,32,32)}),[y.RAIDER_PSYCHO]:new u({source:this.enemyTextureBase.source,frame:new g(0,128,32,32)}),[y.SUPER_MUTANT]:new u({source:this.enemyTextureBase.source,frame:new g(0,160,32,32)}),[y.DEATHCLAW]:new u({source:this.enemyTextureBase.source,frame:new g(0,192,32,32)})}}startWar(){this.isActive=!0,this.container.visible=!0,console.log("War Mode Started!")}endWar(){this.isActive=!1,this.container.visible=!1,this.units.forEach(t=>t.sprite.destroy()),this.enemies.forEach(t=>t.sprite.destroy()),this.units=[],this.enemies=[]}spawnUnit(t){const e={type:t,sprite:new N(this.textures[t]||this.textures[L.SCOUT]),x:50,y:d-100,hp:100,damage:10,speed:2,team:"player"};e.sprite.x=e.x,e.sprite.y=e.y,this.container.addChild(e.sprite),this.units.push(e)}spawnEnemy(t){const e={type:t,sprite:new N(this.textures[t]||this.textures[y.RADROACH]),x:h-50,y:d-100,hp:50,damage:5,speed:1.5,team:"enemy"};e.sprite.x=e.x,e.sprite.y=e.y,e.sprite.scale.x=-1,this.container.addChild(e.sprite),this.enemies.push(e)}update(t){if(this.isActive){for(const e of this.units)this.findTarget(e,this.enemies)||(e.x+=e.speed*t,e.sprite.x=e.x);for(const e of this.enemies)this.findTarget(e,this.units)||(e.x-=e.speed*t,e.sprite.x=e.x)}}findTarget(t,e){for(const s of e)if(Math.abs(t.x-s.x)<40)return s;return null}}class j{constructor(t){this.combatSystem=t,this.day=1,this.waveActive=!1,this.enemiesToSpawn=[],this.spawnTimer=0}startWave(t){this.day=t,this.waveActive=!0,this.enemiesToSpawn=this.generateWave(t),this.combatSystem.startWar(),console.log(`Wave for Day ${t} Started! Enemies: ${this.enemiesToSpawn.length}`)}generateWave(t){const e=[];if(t>=1)for(let s=0;s<5+t;s++)e.push(y.RADROACH);if(t>=2)for(let s=0;s<3+t;s++)e.push(y.MOLE_RAT);if(t>=3)for(let s=0;s<3+t;s++)e.push(y.GHOUL);if(t>=4)for(let s=0;s<2+t;s++)e.push(y.RAIDER_SCUM);if(t>=5)for(let s=0;s<2+t;s++)e.push(y.RAIDER_PSYCHO);if(t>=6)for(let s=0;s<1+t;s++)e.push(y.SUPER_MUTANT);return t>=7&&e.push(y.DEATHCLAW),e.sort(()=>Math.random()-.5)}update(t){if(this.waveActive)if(this.enemiesToSpawn.length>0){if(this.spawnTimer+=t,this.spawnTimer>100){const e=this.enemiesToSpawn.pop();this.combatSystem.spawnEnemy(e),this.spawnTimer=0}}else this.combatSystem.enemies.length===0&&(this.waveActive=!1,this.combatSystem.endWar(),console.log("Wave Cleared!"))}}class J{constructor(t){this.game=t,this.prefix="shelter_war_save_"}save(t){const e={day:this.game.timeSystem.day,dwellers:this.game.workerSystem.dwellers.map(s=>({x:s.sprite.x,y:s.sprite.y,speed:s.speed})),rooms:this.game.gridSystem.tiles.map(s=>s.map(i=>i.type)),timestamp:Date.now()};localStorage.setItem(this.prefix+t,JSON.stringify(e)),console.log(`Game Saved to Slot ${t}`),localStorage.setItem(this.prefix+"auto",JSON.stringify(e))}load(t){const e=localStorage.getItem(this.prefix+t);if(!e)return console.log(`No save found in Slot ${t}`),!1;const s=JSON.parse(e);return console.log(`Loading Save from Slot ${t}...`),this.game.timeSystem.day=s.day,this.game.workerSystem.dwellers.forEach(i=>i.sprite.destroy()),this.game.workerSystem.dwellers=[],s.dwellers.forEach(i=>{this.game.workerSystem.spawnDweller(i.x/32,i.y/32)}),!0}hasSave(t){return!!localStorage.getItem(this.prefix+t)}}class q{constructor(){this.ctx=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.ctx.createGain(),this.masterGain.connect(this.ctx.destination),this.masterGain.gain.value=.5}playSFX(t){this.ctx.state==="suspended"&&this.ctx.resume();const e=this.ctx.createOscillator(),s=this.ctx.createGain();e.connect(s),s.connect(this.masterGain);const i=this.ctx.currentTime;switch(t){case"click":e.type="sine",e.frequency.setValueAtTime(800,i),e.frequency.exponentialRampToValueAtTime(400,i+.1),s.gain.setValueAtTime(.5,i),s.gain.exponentialRampToValueAtTime(.01,i+.1),e.start(i),e.stop(i+.1);break;case"dig":e.type="square",e.frequency.setValueAtTime(100,i),s.gain.setValueAtTime(.3,i),s.gain.exponentialRampToValueAtTime(.01,i+.1),e.start(i),e.stop(i+.1);break;case"shoot":e.type="sawtooth",e.frequency.setValueAtTime(400,i),e.frequency.exponentialRampToValueAtTime(100,i+.2),s.gain.setValueAtTime(.3,i),s.gain.exponentialRampToValueAtTime(.01,i+.2),e.start(i),e.stop(i+.2);break;case"explosion":e.type="triangle",e.frequency.setValueAtTime(100,i),e.frequency.exponentialRampToValueAtTime(10,i+.5),s.gain.setValueAtTime(.8,i),s.gain.exponentialRampToValueAtTime(.01,i+.5),e.start(i),e.stop(i+.5);break}}playMusic(t){console.log(`Playing Music: ${t} (Placeholder)`)}setVolume(t){this.masterGain.gain.value=t}toggleMute(){this.isMuted=!this.isMuted,this.isMuted?this.ctx.suspend():this.ctx.resume()}}class Q{constructor(t){this.game=t,this.container=new T;const e=new E;e.rect(0,0,h,d),e.fill(a.UI_BG),this.container.addChild(e);const s=new f({fontFamily:"Courier New",fontSize:48,fill:a.TEXT,fontWeight:"bold"}),i=new m({text:"SHELTER WAR",style:s});i.x=h/2-i.width/2,i.y=100,this.container.addChild(i);const n=new f({fontFamily:"Courier New",fontSize:16,fill:a.TEXT}),o=new m({text:"v0.0.31",style:n});o.x=h-o.width-10,o.y=d-o.height-10,this.container.addChild(o),this.createButton("NEW GAME",250,()=>this.game.startNewGame()),this.createButton("CONTINUE",320,()=>this.game.loadGame("auto")),this.createButton("BACK TO KROSS GAMES",390,()=>window.location.href="../index.html")}createButton(t,e,s){const i=new f({fontFamily:"Courier New",fontSize:24,fill:a.TEXT}),n=new m({text:`> ${t}`,style:i});n.x=h/2-n.width/2,n.y=e,n.eventMode="static",n.cursor="pointer",n.on("pointerdown",s),this.container.addChild(n)}}class Z{constructor(t){this.game=t,this.container=new T;const e=new E;e.rect(0,0,h,40),e.fill(a.UI_BG),e.stroke({width:2,color:a.UI_BORDER}),this.container.addChild(e);const s=new f({fontFamily:"Courier New",fontSize:16,fill:a.TEXT});this.dayText=new m({text:"Day: 1",style:s}),this.dayText.x=10,this.dayText.y=10,this.container.addChild(this.dayText),this.popText=new m({text:"Pop: 2/10",style:s}),this.popText.x=100,this.popText.y=10,this.container.addChild(this.popText),this.scrapText=new m({text:"Scrap: 0",style:s}),this.scrapText.x=200,this.scrapText.y=10,this.container.addChild(this.scrapText);const i=new f({fontFamily:"Courier New",fontSize:16,fill:a.TEXT,fontWeight:"bold"});this.settingsBtn=new m({text:"[SETTINGS]",style:i}),this.settingsBtn.x=h-120,this.settingsBtn.y=10,this.settingsBtn.eventMode="static",this.settingsBtn.cursor="pointer",this.settingsBtn.on("pointerdown",()=>this.game.settingsMenu.container.visible=!this.game.settingsMenu.container.visible),this.container.addChild(this.settingsBtn);const n=new f({fontFamily:"Courier New",fontSize:16,fill:"#FF0000",fontWeight:"bold"});this.fightBtn=new m({text:"[FIGHT]",style:n}),this.fightBtn.x=h-220,this.fightBtn.y=10,this.fightBtn.eventMode="static",this.fightBtn.cursor="pointer",this.fightBtn.on("pointerdown",()=>{this.game.state==="VAULT"&&this.game.startWar()}),this.container.addChild(this.fightBtn)}update(){this.dayText.text=`Day: ${this.game.timeSystem.day}`,this.popText.text=`Pop: ${this.game.workerSystem.dwellers.length}/10`,this.scrapText.text=`Scrap: ${this.game.scrap||0}`,this.fightBtn.visible=this.game.state==="VAULT"}}class tt{constructor(t){this.game=t,this.container=new T,this.container.y=d-60;const e=new E;e.rect(0,0,600,60),e.fill(a.UI_BG),e.stroke({width:2,color:a.UI_BORDER}),this.container.addChild(e);let s=10;const i={LIVING_QUARTERS:"LIVING",POWER_PLANT:"POWER",DINER:"DINER",WATER_TREATMENT:"WATER",MEDBAY:"MEDBAY",WORKSHOP:"WORKSHOP"},n=Object.values(O);this.buttons=[];for(const o of n){const l=k[o],p=this.createButton(i[o]||o,s,()=>this.selectRoom(o),l);p.roomType=o,this.buttons.push(p),s+=80}this.game.app.ticker.add(()=>this.update())}createButton(t,e,s,i){const n=new T;n.x=e,n.y=10;const o=new f({fontFamily:"Courier New",fontSize:10,fill:a.TEXT,fontWeight:"bold"}),l=new m({text:t,style:o});if(n.addChild(l),i){const p=new f({fontFamily:"Courier New",fontSize:8,fill:"#FFFF00"}),r=new m({text:`(${i})`,style:p});r.y=12,r.x=l.width/2-r.width/2,n.addChild(r)}return n.eventMode="static",n.cursor="pointer",n.on("pointerdown",s),this.container.addChild(n),n}selectRoom(t){if(this.isRoomLocked(t)){console.log("Room Locked!");return}console.log(`Selected Room: ${t}`),this.game.selectedRoom=t}isRoomLocked(t){const e=this.game.timeSystem.day;return t==="MEDBAY"&&e<2||t==="WORKSHOP"&&e<3}update(){this.container.visible&&this.buttons.forEach(t=>{const e=this.isRoomLocked(t.roomType);t.alpha=e?.5:1,t.eventMode=e?"none":"static"})}}class et{constructor(t){this.game=t,this.container=new T,this.container.y=d-60;const e=new E;e.rect(0,0,400,60),e.fill(a.UI_BG),e.stroke({width:2,color:a.UI_BORDER}),this.container.addChild(e);let s=10;const i=Object.values(L);for(const n of i)this.createButton(n,s,()=>this.spawnUnit(n)),s+=90}createButton(t,e,s){const i=new f({fontFamily:"Courier New",fontSize:12,fill:a.TEXT}),n=new m({text:t,style:i});n.x=e,n.y=20,n.eventMode="static",n.cursor="pointer",n.on("pointerdown",s),this.container.addChild(n)}spawnUnit(t){console.log(`Spawn Unit: ${t}`),this.game.combatSystem.spawnUnit(t)}}class st{constructor(t){this.game=t,this.container=new T,this.container.visible=!1;const e=new E;e.rect(0,0,h,d),e.fill({color:0,alpha:.8}),this.container.addChild(e);const s=new E;s.rect(h/2-200,d/2-150,400,300),s.fill(a.UI_BG),s.stroke({width:2,color:a.UI_BORDER}),this.container.addChild(s);const i=new f({fontFamily:"Courier New",fontSize:32,fill:a.TEXT,fontWeight:"bold"}),n=new m({text:"SETTINGS",style:i});n.x=h/2-n.width/2,n.y=d/2-130,this.container.addChild(n);let o=d/2-80;this.createButton(`MUTE: ${this.game.audioSystem.isMuted?"ON":"OFF"}`,o,_=>{this.game.audioSystem.toggleMute(),_.text=`> MUTE: ${this.game.audioSystem.isMuted?"ON":"OFF"}`}),o+=40,this.createButton("SAVE GAME",o,()=>this.game.saveSystem.save(1)),o+=40,this.createButton("OVERSEER MANUAL",o,()=>this.showManual()),o+=40,this.createButton("EXIT TO INTRO",o,()=>this.game.exitToIntro()),o+=40,this.createButton("RESUME DUTIES",o,()=>this.toggle());const l=new f({fontFamily:"Courier New",fontSize:14,fill:a.TEXT}),p=new m({text:"v0.0.31",style:l});p.x=h/2-p.width/2,p.y=d/2+120,this.container.addChild(p),this.manualContainer=new T,this.manualContainer.visible=!1,this.container.addChild(this.manualContainer);const r=new E;r.rect(h/2-250,d/2-200,500,400),r.fill(a.UI_BG),r.stroke({width:2,color:a.UI_BORDER}),this.manualContainer.addChild(r);const D=new m({text:`VAULT OVERSEER MANUAL

OBJECTIVE: EXPAND AND SURVIVE

1. EXCAVATION: Dig deeper to uncover resources.
2. CONSTRUCTION: Build rooms to sustain life.
   - POWER: Essential for operations.
   - DINER/WATER: Sustains population.
3. POPULATION: Assign dwellers to rooms matching their skills.
4. DEFENSE: Train units to repel surface threats.

REMEMBER: A HAPPY VAULT IS A PRODUCTIVE VAULT.

[CLICK TO CLOSE]`,style:new f({fontFamily:"Courier New",fontSize:16,fill:a.TEXT,wordWrap:!0,wordWrapWidth:460,align:"center"})});D.x=h/2-230,D.y=d/2-180,this.manualContainer.addChild(D),r.eventMode="static",r.cursor="pointer",r.on("pointerdown",()=>this.manualContainer.visible=!1)}createButton(t,e,s){const i=new f({fontFamily:"Courier New",fontSize:20,fill:a.TEXT}),n=new m({text:`> ${t}`,style:i});n.x=h/2-n.width/2,n.y=e,n.eventMode="static",n.cursor="pointer",n.on("pointerdown",()=>s(n)),this.container.addChild(n)}toggle(){this.container.visible=!this.container.visible,this.manualContainer.visible=!1}showManual(){this.manualContainer.visible=!0}}class it{constructor(t){this.game=t,this.container=new T,this.container.visible=!1;const e=new E;e.rect(0,0,h,d),e.fill(a.BACKGROUND),this.container.addChild(e);const s=new f({fontFamily:"Courier New",fontSize:48,fill:a.TEXT,fontWeight:"bold"}),i=new m({text:"CONGRATULATIONS!",style:s});i.x=h/2-i.width/2,i.y=100,this.container.addChild(i);const n=new f({fontFamily:"Courier New",fontSize:24,fill:a.TEXT,align:"center"}),o=`
        You have survived 7 Days of War!
        
        Created by: Kross Games
        
        Design: Malice Kross
        Code: Antigravity AI
        Art: Pixel Studio
        
        Thank you for playing!
        `,l=new m({text:o,style:n});l.x=h/2-l.width/2,l.y=200,this.container.addChild(l);const p=new f({fontFamily:"Courier New",fontSize:24,fill:a.TEXT}),r=new m({text:"> BACK TO MENU",style:p});r.x=h/2-r.width/2,r.y=d-100,r.eventMode="static",r.cursor="pointer",r.on("pointerdown",()=>this.game.exitToIntro()),this.container.addChild(r)}}class nt{constructor(){this.container=new T;const t=new E;t.rect(0,0,h,d),t.fill(a.BACKGROUND),this.container.addChild(t);const e=new f({fontFamily:"Courier New",fontSize:32,fill:a.TEXT,fontWeight:"bold"});this.text=new m({text:"LOADING...",style:e}),this.text.x=h/2-this.text.width/2,this.text.y=d/2-50,this.container.addChild(this.text);const s=new E;s.rect(h/2-150,d/2+20,300,20),s.stroke({width:2,color:a.TEXT}),this.container.addChild(s),this.barFill=new E,this.barFill.rect(h/2-148,d/2+22,0,16),this.barFill.fill(a.TEXT),this.container.addChild(this.barFill)}updateProgress(t){this.barFill.clear(),this.barFill.rect(h/2-148,d/2+22,296*t,16),this.barFill.fill(a.TEXT),this.text.text=`LOADING... ${Math.floor(t*100)}%`}}class ot{constructor(){this.app=new V,this.state=C.INTRO,this.root=new T,this.world=new T,this.surface=new T,this.ui=new T}async init(t){await this.app.init({width:h,height:d,backgroundColor:a.BACKGROUND,canvas:t,resolution:window.devicePixelRatio||1,autoDensity:!0}),t||document.body.appendChild(this.app.canvas),window.addEventListener("resize",()=>this.resize()),this.resize(),this.app.stage.addChild(this.root),this.loadingScreen=new nt,this.app.stage.addChild(this.loadingScreen.container),await this.loadAssets(),this.app.stage.removeChild(this.loadingScreen.container),this.root.addChild(this.world),this.root.addChild(this.surface),this.root.addChild(this.ui),this.gridSystem=new $(this.app,this.world),this.pathfinder=new Y(this.gridSystem),this.workerSystem=new X(this.app,this.gridSystem,this.pathfinder),this.timeSystem=new K(this),this.combatSystem=new z(this.app),this.waveSystem=new j(this.combatSystem),this.saveSystem=new J(this),this.audioSystem=new q,this.world.addChild(this.workerSystem.container),this.surface.addChild(this.combatSystem.container),this.combatSystem.container.visible=!1,this.introScreen=new Q(this),this.hud=new Z(this),this.buildMenu=new tt(this),this.unitSelector=new et(this),this.settingsMenu=new st(this),this.creditsScreen=new it(this),this.ui.addChild(this.introScreen.container),this.ui.addChild(this.hud.container),this.ui.addChild(this.buildMenu.container),this.ui.addChild(this.unitSelector.container),this.ui.addChild(this.settingsMenu.container),this.ui.addChild(this.creditsScreen.container),this.hud.container.visible=!1,this.buildMenu.container.visible=!1,this.unitSelector.container.visible=!1,this.gridSystem.onTileClick=(e,s)=>this.handleTileClick(e,s),this.app.ticker.add(e=>{this.update(e.deltaTime)}),this.saveSystem.hasSave("auto")&&console.log("Auto-save found."),console.log("Shelter War Game Initialized"),this.audioSystem.playMusic("menu")}async loadAssets(){const t="/kross_games/",e="0.0.31",s=[{alias:"tiles",src:`${t}shelter_war/assets/tiles.png?v=${e}`},{alias:"ui",src:`${t}shelter_war/assets/ui.png?v=${e}`},{alias:"rooms",src:`${t}shelter_war/assets/rooms.png?v=${e}`},{alias:"dwellers",src:`${t}shelter_war/assets/dwellers.png?v=${e}`},{alias:"mr_handy",src:`${t}shelter_war/assets/mr_handy.png?v=${e}`},{alias:"combat_units",src:`${t}shelter_war/assets/combat_units.png?v=${e}`},{alias:"enemies",src:`${t}shelter_war/assets/enemies.png?v=${e}`}];await M.load(s),this.loadingScreen.updateProgress(1)}update(t){this.state!==C.INTRO&&(this.workerSystem.update(t),this.timeSystem.update(t),this.combatSystem.update(t),this.waveSystem.update(t),this.hud.update())}startNewGame(){this.state=C.VAULT,this.introScreen.container.visible=!1,this.hud.container.visible=!0,this.buildMenu.container.visible=!0,this.workerSystem.dwellers.forEach(t=>t.sprite.destroy()),this.workerSystem.dwellers=[],this.workerSystem.spawnDweller(2,2),this.workerSystem.spawnDweller(3,2),this.timeSystem.day=1,this.timeSystem.time=0,this.scrap=10,this.audioSystem.playSFX("click"),console.log("New Game Started")}loadGame(t){this.saveSystem.load(t)&&(this.state=C.VAULT,this.introScreen.container.visible=!1,this.hud.container.visible=!0,this.buildMenu.container.visible=!0,this.audioSystem.playSFX("click"),console.log("Game Loaded"))}exitToIntro(){this.state=C.INTRO,this.introScreen.container.visible=!0,this.hud.container.visible=!1,this.buildMenu.container.visible=!1,this.unitSelector.container.visible=!1,this.settingsMenu.container.visible=!1,this.creditsScreen.container.visible=!1,this.world.visible=!0,this.surface.visible=!1,this.audioSystem.playSFX("click")}onNewDay(t){if(t>7){this.showCredits();return}this.workerSystem.dwellers.length<10&&(this.workerSystem.spawnDweller(2,2),console.log("New Dweller arrived!")),this.saveSystem.save("auto"),console.log("New Day Started. Prepare for war!")}startWar(){this.startWarMode(this.timeSystem.day)}startWarMode(t){this.state=C.WAR,this.world.visible=!1,this.surface.visible=!0,this.combatSystem.container.visible=!0,this.buildMenu.container.visible=!1,this.unitSelector.container.visible=!0,this.waveSystem.startWave(t)}endWarMode(t){t?(console.log("Victory! Returning to Vault."),this.state=C.VAULT,this.world.visible=!0,this.surface.visible=!1,this.combatSystem.endWar(),this.buildMenu.container.visible=!0,this.unitSelector.container.visible=!1,this.timeSystem.advanceDay()):(console.log("Defeat! Retrying Wave..."),this.retryWave())}retryWave(){this.combatSystem.endWar(),this.waveSystem.startWave(this.timeSystem.day)}showCredits(){this.state=C.INTRO,this.creditsScreen.container.visible=!0,this.hud.container.visible=!1,this.buildMenu.container.visible=!1,this.unitSelector.container.visible=!1,this.world.visible=!1,this.surface.visible=!1}handleTileClick(t,e){if(this.state===C.VAULT){if(this.selectedRoom){const s=k[this.selectedRoom];this.scrap>=s?(this.scrap-=s,console.log(`Order: Build ${this.selectedRoom} at ${t}, ${e} (Cost: ${s})`),this.workerSystem.addJob(A.BUILD,t,e,{roomType:this.selectedRoom}),this.audioSystem.playSFX("click"),this.selectedRoom=null):console.log("Not enough scrap to build!");return}this.scrap>=1?(this.scrap-=1,console.log(`Order: Dig at ${t}, ${e} (Cost: 1 Scrap)`),this.workerSystem.addJob(A.DIG,t,e),this.audioSystem.playSFX("dig")):console.log("Not enough scrap to mine!")}}resize(){const t=window.innerWidth,e=window.innerHeight,s=t/h,i=e/d,n=Math.min(s,i);this.app.stage.scale.set(n),this.app.stage.x=(t-h*n)/2,this.app.stage.y=(e-d*n)/2,this.app.renderer.resize(t,e)}}const at=document.getElementById("game-canvas"),rt=new ot;rt.init(at).catch(console.error);
