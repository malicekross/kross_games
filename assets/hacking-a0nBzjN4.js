import"./modulepreload-polyfill-B5Qt9EMX.js";import{M as P,O as d,V as R,d as w,v as m,C as O,T as p,b as u,c as b,e as v,f as F,R as T,A as U,g as C}from"./index-C9Gq2ce5.js";class A{constructor({matrix:t,observer:e}={}){this.dirty=!0,this._matrix=t??new P,this.observer=e,this.position=new d(this,0,0),this.scale=new d(this,1,1),this.pivot=new d(this,0,0),this.skew=new d(this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1}get matrix(){const t=this._matrix;return this.dirty&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this.dirty=!1),t}_onUpdate(t){this.dirty=!0,t===this.skew&&this.updateSkew(),this.observer?._onUpdate(this)}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this.dirty=!0}toString(){return`[pixi.js/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}setFromMatrix(t){t.decompose(this),this.dirty=!0}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._onUpdate(this.skew))}}const E=class x extends R{constructor(...t){let e=t[0]||{};e instanceof p&&(e={texture:e}),t.length>1&&(w(m,"use new TilingSprite({ texture, width:100, height:100 }) instead"),e.width=t[1],e.height=t[2]),e={...x.defaultOptions,...e};const{texture:s,anchor:i,tilePosition:r,tileScale:n,tileRotation:h,width:o,height:a,applyAnchorToTexture:l,roundPixels:y,...c}=e??{};super({label:"TilingSprite",...c}),this.renderPipeId="tilingSprite",this.batched=!0,this.allowChildren=!1,this._anchor=new d({_onUpdate:()=>{this.onViewUpdate()}}),this.applyAnchorToTexture=l,this.texture=s,this._width=o??s.width,this._height=a??s.height,this._tileTransform=new A({observer:{_onUpdate:()=>this.onViewUpdate()}}),i&&(this.anchor=i),this.tilePosition=r,this.tileScale=n,this.tileRotation=h,this.roundPixels=y??!1}static from(t,e={}){return typeof t=="string"?new x({texture:O.get(t),...e}):new x({texture:t,...e})}get uvRespectAnchor(){return w(m,"uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture}set uvRespectAnchor(t){w(m,"uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture=t}get clampMargin(){return this._texture.textureMatrix.clampMargin}set clampMargin(t){this._texture.textureMatrix.clampMargin=t}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get tilePosition(){return this._tileTransform.position}set tilePosition(t){this._tileTransform.position.copyFrom(t)}get tileScale(){return this._tileTransform.scale}set tileScale(t){typeof t=="number"?this._tileTransform.scale.set(t):this._tileTransform.scale.copyFrom(t)}set tileRotation(t){this._tileTransform.rotation=t}get tileRotation(){return this._tileTransform.rotation}get tileTransform(){return this._tileTransform}set texture(t){t||(t=p.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this.onViewUpdate())}get texture(){return this._texture}set width(t){this._width=t,this.onViewUpdate()}get width(){return this._width}set height(t){this._height=t,this.onViewUpdate()}get height(){return this._height}setSize(t,e){typeof t=="object"&&(e=t.height??t.width,t=t.width),this._width=t,this._height=e??t,this.onViewUpdate()}getSize(t){return t||(t={}),t.width=this._width,t.height=this._height,t}updateBounds(){const t=this._bounds,e=this._anchor,s=this._width,i=this._height;t.minX=-e._x*s,t.maxX=t.minX+s,t.minY=-e._y*i,t.maxY=t.minY+i}containsPoint(t){const e=this._width,s=this._height,i=-e*this._anchor._x;let r=0;return t.x>=i&&t.x<=i+e&&(r=-s*this._anchor._y,t.y>=r&&t.y<=r+s)}destroy(t=!1){if(super.destroy(t),this._anchor=null,this._tileTransform=null,this._bounds=null,typeof t=="boolean"?t:t?.texture){const s=typeof t=="boolean"?t:t?.textureSource;this._texture.destroy(s)}this._texture=null}};E.defaultOptions={texture:p.EMPTY,anchor:{x:0,y:0},tilePosition:{x:0,y:0},tileScale:{x:1,y:1},tileRotation:0,applyAnchorToTexture:!1};let L=E;const G="/kross_games/assets/sprites-BLfl1JFh.svg",N="data:image/svg+xml,%3csvg%20width='96'%20height='32'%20viewBox='0%200%2096%2032'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3crect%20id='p'%20width='2'%20height='2'%20fill='%23FFFFFF'/%3e%3c/defs%3e%3cg%20id='frame1'%3e%3cuse%20href='%23p'%20x='0'%20y='14'/%3e%3cuse%20href='%23p'%20x='2'%20y='14'/%3e%3cuse%20href='%23p'%20x='0'%20y='16'/%3e%3cuse%20href='%23p'%20x='2'%20y='16'/%3e%3cuse%20href='%23p'%20x='4'%20y='12'/%3e%3cuse%20href='%23p'%20x='6'%20y='12'/%3e%3cuse%20href='%23p'%20x='4'%20y='14'/%3e%3cuse%20href='%23p'%20x='6'%20y='14'/%3e%3cuse%20href='%23p'%20x='8'%20y='10'/%3e%3cuse%20href='%23p'%20x='10'%20y='10'/%3e%3cuse%20href='%23p'%20x='8'%20y='12'/%3e%3cuse%20href='%23p'%20x='10'%20y='12'/%3e%3cuse%20href='%23p'%20x='12'%20y='12'/%3e%3cuse%20href='%23p'%20x='14'%20y='12'/%3e%3cuse%20href='%23p'%20x='12'%20y='14'/%3e%3cuse%20href='%23p'%20x='14'%20y='14'/%3e%3cuse%20href='%23p'%20x='16'%20y='14'/%3e%3cuse%20href='%23p'%20x='18'%20y='14'/%3e%3cuse%20href='%23p'%20x='16'%20y='16'/%3e%3cuse%20href='%23p'%20x='18'%20y='16'/%3e%3cuse%20href='%23p'%20x='20'%20y='16'/%3e%3cuse%20href='%23p'%20x='22'%20y='16'/%3e%3cuse%20href='%23p'%20x='20'%20y='18'/%3e%3cuse%20href='%23p'%20x='22'%20y='18'/%3e%3cuse%20href='%23p'%20x='24'%20y='18'/%3e%3cuse%20href='%23p'%20x='26'%20y='18'/%3e%3cuse%20href='%23p'%20x='24'%20y='20'/%3e%3cuse%20href='%23p'%20x='26'%20y='20'/%3e%3cuse%20href='%23p'%20x='28'%20y='16'/%3e%3cuse%20href='%23p'%20x='30'%20y='16'/%3e%3cuse%20href='%23p'%20x='28'%20y='18'/%3e%3cuse%20href='%23p'%20x='30'%20y='18'/%3e%3c/g%3e%3cg%20id='frame2'%20transform='translate(32,%200)'%3e%3cuse%20href='%23p'%20x='0'%20y='18'/%3e%3cuse%20href='%23p'%20x='2'%20y='18'/%3e%3cuse%20href='%23p'%20x='0'%20y='20'/%3e%3cuse%20href='%23p'%20x='2'%20y='20'/%3e%3cuse%20href='%23p'%20x='4'%20y='16'/%3e%3cuse%20href='%23p'%20x='6'%20y='16'/%3e%3cuse%20href='%23p'%20x='4'%20y='18'/%3e%3cuse%20href='%23p'%20x='6'%20y='18'/%3e%3cuse%20href='%23p'%20x='8'%20y='14'/%3e%3cuse%20href='%23p'%20x='10'%20y='14'/%3e%3cuse%20href='%23p'%20x='8'%20y='16'/%3e%3cuse%20href='%23p'%20x='10'%20y='16'/%3e%3cuse%20href='%23p'%20x='12'%20y='12'/%3e%3cuse%20href='%23p'%20x='14'%20y='12'/%3e%3cuse%20href='%23p'%20x='12'%20y='14'/%3e%3cuse%20href='%23p'%20x='14'%20y='14'/%3e%3cuse%20href='%23p'%20x='16'%20y='10'/%3e%3cuse%20href='%23p'%20x='18'%20y='10'/%3e%3cuse%20href='%23p'%20x='16'%20y='12'/%3e%3cuse%20href='%23p'%20x='18'%20y='12'/%3e%3cuse%20href='%23p'%20x='20'%20y='12'/%3e%3cuse%20href='%23p'%20x='22'%20y='12'/%3e%3cuse%20href='%23p'%20x='20'%20y='14'/%3e%3cuse%20href='%23p'%20x='22'%20y='14'/%3e%3cuse%20href='%23p'%20x='24'%20y='14'/%3e%3cuse%20href='%23p'%20x='26'%20y='14'/%3e%3cuse%20href='%23p'%20x='24'%20y='16'/%3e%3cuse%20href='%23p'%20x='26'%20y='16'/%3e%3cuse%20href='%23p'%20x='28'%20y='16'/%3e%3cuse%20href='%23p'%20x='30'%20y='16'/%3e%3cuse%20href='%23p'%20x='28'%20y='18'/%3e%3cuse%20href='%23p'%20x='30'%20y='18'/%3e%3c/g%3e%3cg%20id='frame3'%20transform='translate(64,%200)'%3e%3cuse%20href='%23p'%20x='0'%20y='12'/%3e%3cuse%20href='%23p'%20x='2'%20y='12'/%3e%3cuse%20href='%23p'%20x='0'%20y='14'/%3e%3cuse%20href='%23p'%20x='2'%20y='14'/%3e%3cuse%20href='%23p'%20x='4'%20y='14'/%3e%3cuse%20href='%23p'%20x='6'%20y='14'/%3e%3cuse%20href='%23p'%20x='4'%20y='16'/%3e%3cuse%20href='%23p'%20x='6'%20y='16'/%3e%3cuse%20href='%23p'%20x='8'%20y='16'/%3e%3cuse%20href='%23p'%20x='10'%20y='16'/%3e%3cuse%20href='%23p'%20x='8'%20y='18'/%3e%3cuse%20href='%23p'%20x='10'%20y='18'/%3e%3cuse%20href='%23p'%20x='12'%20y='18'/%3e%3cuse%20href='%23p'%20x='14'%20y='18'/%3e%3cuse%20href='%23p'%20x='12'%20y='20'/%3e%3cuse%20href='%23p'%20x='14'%20y='20'/%3e%3cuse%20href='%23p'%20x='16'%20y='16'/%3e%3cuse%20href='%23p'%20x='18'%20y='16'/%3e%3cuse%20href='%23p'%20x='16'%20y='18'/%3e%3cuse%20href='%23p'%20x='18'%20y='18'/%3e%3cuse%20href='%23p'%20x='20'%20y='14'/%3e%3cuse%20href='%23p'%20x='22'%20y='14'/%3e%3cuse%20href='%23p'%20x='20'%20y='16'/%3e%3cuse%20href='%23p'%20x='22'%20y='16'/%3e%3cuse%20href='%23p'%20x='24'%20y='12'/%3e%3cuse%20href='%23p'%20x='26'%20y='12'/%3e%3cuse%20href='%23p'%20x='24'%20y='14'/%3e%3cuse%20href='%23p'%20x='26'%20y='14'/%3e%3cuse%20href='%23p'%20x='28'%20y='10'/%3e%3cuse%20href='%23p'%20x='30'%20y='10'/%3e%3cuse%20href='%23p'%20x='28'%20y='12'/%3e%3cuse%20href='%23p'%20x='30'%20y='12'/%3e%3c/g%3e%3c/svg%3e";class D{constructor(t,e,s="neutral",i){this.x=t,this.y=e,this.owner=s,this.lastOwner=s,this.value=10,this.capacity=60,this.radius=30,this.level=1,this.generationRate=1.1,this.maxConnections=1,this.timer=0,this.colors={player:65437,enemy:16724787,neutral:8947848},this.container=new u,this.container.x=t,this.container.y=e,this.graphics=new b,this.container.addChild(this.graphics),this.spritesTexture=i,this.sprite=new v(this.getTextureFrame()),this.sprite.anchor.set(.5),this.sprite.width=64,this.sprite.height=64,this.container.addChild(this.sprite),this.text=new F({text:Math.floor(this.value),style:{fontFamily:"Courier New",fontSize:24,fontWeight:"bold",fill:16777215,stroke:{color:0,width:4}}}),this.text.anchor.set(.5),this.container.addChild(this.text),this.updateVisuals()}getTextureFrame(){let t=6;return this.owner==="player"?t=this.level-1:this.owner==="enemy"&&(t=3+(this.level-1)),new p({source:this.spritesTexture.source,frame:new T(t*64,0,64,64)})}update(t,e=0){let s=this.level;if(this.value>=30&&this.level<3?(this.level=3,this.generationRate=3.3):this.value>=15&&this.level<2?(this.level=2,this.generationRate=2.2):this.value<15&&(this.level=1,this.generationRate=1.1),this.maxConnections=this.level,this.owner!=="neutral"&&this.value<this.capacity){this.timer+=t;let i=this.generationRate;this.owner==="player"&&(i*=1.1),this.timer>=1/i&&(this.value++,this.timer=0)}this.updateVisuals(s,e)}updateVisuals(t,e){this.text.text=Math.floor(this.value),this.graphics.clear(),this.owner!=="neutral"?(this.graphics.circle(0,0,this.radius+5+this.level*2),this.graphics.fill({color:this.colors[this.owner],alpha:.3})):(this.graphics.circle(0,0,this.radius),this.graphics.fill({color:1710618}),this.graphics.stroke({width:3,color:this.colors[this.owner]})),this.sprite.texture=this.getTextureFrame();const s=4,i=10,r=this.radius+15;let n=-((this.maxConnections-1)*i)/2;for(let h=0;h<this.maxConnections;h++)this.graphics.circle(n+h*i,r,s),h<e?this.graphics.fill({color:this.colors[this.owner]||16777215}):(this.graphics.fill({color:0}),this.graphics.stroke({width:1,color:this.colors[this.owner]||16777215}))}contains(t,e){const s=this.x-t,i=this.y-e;return s*s+i*i<=this.radius*this.radius}destroy(){this.container.destroy({children:!0})}}class _{constructor(t,e,s,i,r,n){this.x=t,this.y=e,this.target=s,this.owner=i,this.source=r,this.speed=150,this.active=!0,this.radius=4,this.container=new u,this.container.x=t,this.container.y=e;let h=Math.floor(Math.random()*10)+9;this.sprite=new v(new p({source:n.source,frame:new T(h*64,0,64,64)})),this.sprite.anchor.set(.5),this.sprite.width=24,this.sprite.height=24,this.owner==="player"?this.sprite.tint=65535:this.sprite.tint=16711935,this.shadow=new v(new p({source:n.source,frame:new T(h*64,0,64,64)})),this.shadow.anchor.set(.5),this.shadow.width=24,this.shadow.height=24,this.shadow.tint=0,this.shadow.alpha=.6,this.shadow.position.set(3,3),this.container.addChild(this.shadow),this.container.addChild(this.sprite)}update(t,e){if(!this.active)return;const s=this.target.x-this.x,i=this.target.y-this.y,r=Math.sqrt(s*s+i*i);if(r<5){this.hitTarget(e);return}const n=this.speed*t;this.x+=s/r*n,this.y+=i/r*n,this.container.x=this.x,this.container.y=this.y}hitTarget(t){if(this.active=!1,this.target.owner===this.owner){if(this.target.value<this.target.capacity)this.target.value++;else if(t){const e=t.connections.filter(s=>s.from===this.target);if(e.length>0){const s=e[Math.floor(Math.random()*e.length)],i=new _(this.target.x,this.target.y,s.to,this.owner,this.target,t.spritesTexture);t.units.push(i),t.unitLayer.addChild(i.container)}}}else this.target.value--,this.target.value<=0&&(this.target.owner=this.owner,this.target.value=Math.abs(this.target.value))}destroy(){this.container.destroy({children:!0})}}class ${constructor(t,e,s){this.from=t,this.to=e,this.timer=0,this.rate=1,this.growthTimer=0,this.growthDuration=.5,this.fullyGrown=!1,this.container=new u;const i=this.to.x-this.from.x,r=this.to.y-this.from.y;this.distance=Math.sqrt(i*i+r*r),this.angle=Math.atan2(r,i),this.container.x=this.from.x,this.container.y=this.from.y,this.container.rotation=this.angle,this.sprite=new L({texture:s,width:0,height:32}),this.sprite.anchor.set(0,.5),this.sprite.tint=this.from.owner==="enemy"?16729156:65437,this.container.addChild(this.sprite)}update(t,e){const i=e.connections.find(r=>r.from===this.to&&r.to===this.from)?this.distance/2:this.distance;if(this.fullyGrown?this.sprite.width=i:(this.growthTimer+=t,this.growthTimer>=this.growthDuration&&(this.fullyGrown=!0,this.growthTimer=this.growthDuration),this.sprite.width=Math.min(this.growthTimer/this.growthDuration*this.distance,i)),this.sprite.tilePosition.x+=50*t,this.fullyGrown&&this.from.value>=1){this.timer+=t;const r=this.from.generationRate/2;if(this.timer>=1/r){this.timer=0,this.from.value--;const n=new _(this.from.x,this.from.y,this.to,this.from.owner,this.from,e.spritesTexture);e.units.push(n),e.unitLayer.addChild(n.container)}}}destroy(){this.container.destroy({children:!0})}}class V{constructor(){this.app=new U,this.nodes=[],this.units=[],this.connections=[],this.isDragging=!1,this.isCutting=!1,this.dragStartNode=null,this.cutStart={x:0,y:0},this.mouseX=0,this.mouseY=0,this.ui={playerScore:document.getElementById("player-score"),enemyScore:document.getElementById("enemy-score"),scoreBarFill:document.getElementById("score-bar-fill"),victoryScreen:document.getElementById("victory-screen")},this.lastPlayerScore=-1,this.lastEnemyScore=-1,this.gameOverTriggered=!1,this.gameOverTimer=0,this.paused=!1}async init(t){const e=window.innerWidth<768,s={canvas:t,backgroundColor:328976,antialias:!0,resolution:window.devicePixelRatio||1,autoDensity:!0};e?(s.width=window.innerWidth*.9,s.height=window.innerHeight*.9):s.resizeTo=window,await this.app.init(s),this.spritesTexture=await C.load(G),this.wireTexture=await C.load(N),this.connectionLayer=new u,this.nodeLayer=new u,this.unitLayer=new u,this.uiLayer=new u,this.app.stage.addChild(this.connectionLayer),this.app.stage.addChild(this.unitLayer),this.app.stage.addChild(this.nodeLayer),this.app.stage.addChild(this.uiLayer),this.app.stage.eventMode="static",this.app.stage.hitArea=this.app.screen,this.app.stage.on("pointerdown",i=>this.handleInputStart(i)),this.app.stage.on("pointermove",i=>this.handleInputMove(i)),this.app.stage.on("pointerup",i=>this.handleInputEnd(i)),this.app.stage.on("pointerupoutside",i=>this.handleInputEnd(i)),this.dragGraphics=new b,this.uiLayer.addChild(this.dragGraphics),console.log("Game initialized with PixiJS"),this.app.ticker.add(i=>{this.update(i.deltaTime/60)})}generateLevel(){this.nodes.forEach(h=>h.destroy()),this.units.forEach(h=>h.destroy()),this.connections.forEach(h=>h.destroy()),this.nodes=[],this.units=[],this.connections=[],this.gameOverTriggered=!1,this.gameOverTimer=0,this.paused=!1;const t=this.app.screen.width<768,e=Math.floor(Math.random()*6)+5,s=t?50:100,i=t?100:150,r=this.app.screen.width,n=this.app.screen.height;console.log(`Target Node Count: ${e}, Canvas: ${r}x${n}, Mobile: ${t}`);for(let h=0;h<e;h++){let o=!1,a,l,y=0;for(;!o&&y<100;){a=s+Math.random()*(r-s*2),l=s+Math.random()*(n-s*2),o=!0;for(const c of this.nodes){const f=c.x-a,S=c.y-l;if(Math.sqrt(f*f+S*S)<i){o=!1;break}}y++}if(o){let c="neutral";h===0&&(c="player"),h===1&&(c="enemy");const f=new D(a,l,c,this.spritesTexture);(c==="player"||c==="enemy")&&(f.value=Math.floor(Math.random()*11)+20),t&&f.container.scale.set(.75),this.nodes.push(f),this.nodeLayer.addChild(f.container)}else console.warn("Failed to place node after 100 attempts")}}update(t){if(!this.paused){this.nodes.forEach(e=>{if(e.owner!==e.lastOwner){if(e.lastOwner==="player"&&e.owner==="enemy"||e.lastOwner==="enemy"&&e.owner==="player")for(let i=this.connections.length-1;i>=0;i--){const r=this.connections[i];r.from===e&&(r.destroy(),this.connections.splice(i,1))}e.lastOwner=e.owner}const s=this.connections.filter(i=>i.from===e).length;e.update(t,s)}),this.connections.forEach(e=>e.update(t,this)),this.units.forEach(e=>e.update(t,this)),this.updateAI(t);for(let e=this.units.length-1;e>=0;e--)this.units[e].active||(this.units[e].destroy(),this.units.splice(e,1));for(let e=this.connections.length-1;e>=0;e--)this.connections[e].from.owner==="neutral"&&(this.connections[e].destroy(),this.connections.splice(e,1));this.updateScoreUI(),this.checkWinCondition(t),this.drawDragUI()}}drawDragUI(){this.dragGraphics.clear(),this.isDragging&&this.dragStartNode?(this.dragGraphics.moveTo(this.dragStartNode.x,this.dragStartNode.y),this.dragGraphics.lineTo(this.mouseX,this.mouseY),this.dragGraphics.stroke({width:2,color:16777215,alpha:.5,dash:[5,5]})):this.isCutting&&(this.dragGraphics.moveTo(this.cutStart.x,this.cutStart.y),this.dragGraphics.lineTo(this.mouseX,this.mouseY),this.dragGraphics.stroke({width:2,color:16711680}))}checkWinCondition(t){if(this.gameOverTriggered){this.gameOverTimer+=t,this.gameOverTimer>5&&(this.paused=!0);return}let e=0,s=0;if(this.nodes.forEach(i=>{i.owner==="enemy"&&(e+=Math.floor(i.value)),i.owner==="player"&&(s+=Math.floor(i.value))}),this.units.forEach(i=>{i.owner==="enemy"&&e++,i.owner==="player"&&s++}),e===0)this.gameOverTriggered=!0,this.ui.victoryScreen&&(this.ui.victoryScreen.style.display="flex");else if(s===0){this.gameOverTriggered=!0;const i=document.getElementById("defeat-screen");i&&(i.style.display="flex")}}updateScoreUI(){let t=0,e=0;if(this.nodes.forEach(s=>{s.owner==="player"&&(t+=Math.floor(s.value)),s.owner==="enemy"&&(e+=Math.floor(s.value))}),this.units.forEach(s=>{s.owner==="player"&&t++,s.owner==="enemy"&&e++}),(t!==this.lastPlayerScore||e!==this.lastEnemyScore)&&(this.lastPlayerScore=t,this.lastEnemyScore=e,this.ui.playerScore&&(this.ui.playerScore.innerText=t),this.ui.enemyScore&&(this.ui.enemyScore.innerText=e),this.ui.scoreBarFill)){const s=t+e,i=s>0?t/s*100:50;this.ui.scoreBarFill.style.width=`${i}%`}}handleInputStart(t){const e=t.global.x,s=t.global.y,i=this.nodes.find(r=>r.contains(e,s));i&&i.owner==="player"?(this.isDragging=!0,this.dragStartNode=i):(this.isCutting=!0,this.cutStart={x:e,y:s},this.mouseX=e,this.mouseY=s)}handleInputMove(t){this.mouseX=t.global.x,this.mouseY=t.global.y}handleInputEnd(t){const e=t.global.x,s=t.global.y;if(this.isDragging&&this.dragStartNode){const i=this.nodes.find(r=>r.contains(e,s));i&&i!==this.dragStartNode&&this.createConnection(this.dragStartNode,i)}else this.isCutting&&this.connections.filter(r=>r.from.owner==="enemy"?!1:this.linesIntersect(this.cutStart,{x:this.mouseX,y:this.mouseY},r.from,r.to)).forEach(r=>{this.units.forEach(h=>{h.source===r.from&&h.target===r.to&&h.active&&h.hitTarget()}),r.destroy();const n=this.connections.indexOf(r);n>-1&&this.connections.splice(n,1)});this.isDragging=!1,this.isCutting=!1,this.dragStartNode=null}createConnection(t,e){if(this.connections.find(h=>h.from===t&&h.to===e)){console.log("Connection rejected: Already exists");return}const i=this.connections.find(h=>h.from===e&&h.to===t),r=this.connections.filter(h=>h.from===t).length;if(r>=t.maxConnections){console.log(`Connection rejected: Max connections reached (${r}/${t.maxConnections})`);return}i&&t.owner===e.owner&&(i.destroy(),this.connections=this.connections.filter(h=>h!==i));const n=new $(t,e,this.wireTexture);this.connections.push(n),this.connectionLayer.addChild(n.container)}linesIntersect(t,e,s,i){const r=(e.x-t.x)*(i.y-s.y)-(i.x-s.x)*(e.y-t.y);if(r===0)return!1;const n=((i.y-s.y)*(i.x-t.x)+(s.x-i.x)*(i.y-t.y))/r,h=((t.y-e.y)*(i.x-t.x)+(e.x-t.x)*(i.y-t.y))/r;return 0<n&&n<1&&0<h&&h<1}updateAI(t){if(this.aiTimer=(this.aiTimer||0)+t,this.aiTimer<3)return;this.aiTimer=0,this.nodes.filter(s=>s.owner==="enemy").forEach(s=>{if(this.connections.filter(o=>o.from===s).length>=s.maxConnections)return;let r=this.nodes.filter(o=>o!==s);r=r.filter(o=>!this.connections.some(a=>a.from===s&&a.to===o));let n=null;const h=r.filter(o=>o.owner==="neutral");if(h.length>0&&(n=h[Math.floor(Math.random()*h.length)]),!n){const a=r.filter(l=>l.owner==="player").filter(l=>s.value>l.value);a.length>0&&(n=a[Math.floor(Math.random()*a.length)])}n&&this.createConnection(s,n)})}}const k="v0.0.22";document.getElementById("version").innerText=k+" (PixiJS)";console.log("Hacking Wars "+k+" (PixiJS)");const I=document.createElement("canvas");document.body.appendChild(I);const M=new V;M.init(I).then(()=>{M.generateLevel()});
