const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Connection-kHgCJPxU.js","assets/modulepreload-polyfill-B5Qt9EMX.js"])))=>i.map(i=>d[i]);
import"./modulepreload-polyfill-B5Qt9EMX.js";const x="modulepreload",v=function(d){return"/kross_games/"+d},m={},E=function(e,t,i){let n=Promise.resolve();if(t&&t.length>0){let g=function(c){return Promise.all(c.map(h=>Promise.resolve(h).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),r=s?.nonce||s?.getAttribute("nonce");n=g(t.map(c=>{if(c=v(c),c in m)return;m[c]=!0;const h=c.endsWith(".css"),u=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const a=document.createElement("link");if(a.rel=h?"stylesheet":x,h||(a.as="script"),a.crossOrigin="",a.href=c,r&&a.setAttribute("nonce",r),document.head.appendChild(a),h)return new Promise((p,y)=>{a.addEventListener("load",p),a.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(s){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=s,window.dispatchEvent(r),!r.defaultPrevented)throw s}return n.then(s=>{for(const r of s||[])r.status==="rejected"&&o(r.reason);return e().catch(o)})},w="/kross_games/assets/sprites-ClHaEWzu.svg";class S{constructor(e){this.canvas=e,this.ctx=e.getContext("2d"),this.nodes=[],this.units=[],this.connections=[],this.lastTime=0,this.resize(),window.addEventListener("resize",()=>this.resize()),this.isDragging=!1,this.isCutting=!1,this.dragStartNode=null,this.cutStart={x:0,y:0},this.mouseX=0,this.mouseY=0,this.canvas.addEventListener("mousedown",t=>this.handleInputStart(t)),this.canvas.addEventListener("mousemove",t=>this.handleInputMove(t)),this.canvas.addEventListener("mouseup",t=>this.handleInputEnd(t)),this.sprites=new Image,this.sprites.src=w,this.spritesLoaded=!1,this.sprites.onload=()=>{this.spritesLoaded=!0}}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}start(){this.lastTime=performance.now(),requestAnimationFrame(e=>this.loop(e))}loop(e){let t=(e-this.lastTime)/1e3;this.lastTime=e,t>.1&&(t=.1),this.update(t),this.draw(),requestAnimationFrame(i=>this.loop(i))}update(e){this.nodes.forEach(t=>t.update(e)),this.connections.forEach(t=>t.update(e,this)),this.units.forEach(t=>t.update(e)),this.units=this.units.filter(t=>t.active),this.connections=this.connections.filter(t=>t.from.owner==="player"),this.updateScoreUI(),this.checkWinCondition()}checkWinCondition(){let e=0;if(this.nodes.forEach(t=>{t.owner==="enemy"&&(e+=Math.floor(t.value))}),this.units.forEach(t=>{t.owner==="enemy"&&e++}),e===0){const t=document.getElementById("victory-screen");t&&(t.style.display="flex")}}updateScoreUI(){let e=0,t=0;this.nodes.forEach(s=>{s.owner==="player"&&(e+=Math.floor(s.value)),s.owner==="enemy"&&(t+=Math.floor(s.value))}),this.units.forEach(s=>{s.owner==="player"&&e++,s.owner==="enemy"&&t++});const i=document.getElementById("player-score"),n=document.getElementById("enemy-score"),o=document.getElementById("score-bar-fill");if(i&&(i.innerText=e),n&&(n.innerText=t),o){const s=e+t,r=s>0?e/s*100:50;o.style.width=`${r}%`}}draw(){this.ctx.fillStyle="#050510",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.connections.forEach(e=>e.draw(this.ctx)),this.isDragging&&this.dragStartNode&&(this.ctx.beginPath(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.5)",this.ctx.setLineDash([5,5]),this.ctx.moveTo(this.dragStartNode.x,this.dragStartNode.y),this.ctx.lineTo(this.mouseX,this.mouseY),this.ctx.stroke(),this.ctx.setLineDash([])),this.isCutting&&(this.ctx.beginPath(),this.ctx.strokeStyle="#ff0000",this.ctx.lineWidth=2,this.ctx.moveTo(this.cutStart.x,this.cutStart.y),this.ctx.lineTo(this.mouseX,this.mouseY),this.ctx.stroke()),this.nodes.forEach(e=>{const t=this.connections.filter(i=>i.from===e).length;e.draw(this.ctx,this.sprites,this.spritesLoaded,t)}),this.units.forEach(e=>e.draw(this.ctx,this.sprites,this.spritesLoaded))}handleInputStart(e){const t=this.canvas.getBoundingClientRect(),i=e.clientX-t.left,n=e.clientY-t.top,o=this.nodes.find(s=>s.contains(i,n));o&&o.owner==="player"?(this.isDragging=!0,this.dragStartNode=o):(this.isCutting=!0,this.cutStart={x:i,y:n},this.mouseX=i,this.mouseY=n)}handleInputMove(e){const t=this.canvas.getBoundingClientRect();this.mouseX=e.clientX-t.left,this.mouseY=e.clientY-t.top}handleInputEnd(e){if(this.isDragging&&this.dragStartNode){const t=this.canvas.getBoundingClientRect(),i=e.clientX-t.left,n=e.clientY-t.top,o=this.nodes.find(s=>s.contains(i,n));o&&o!==this.dragStartNode&&this.createConnection(this.dragStartNode,o)}else if(this.isCutting){const t=this.connections.filter(i=>this.linesIntersect(this.cutStart,{x:this.mouseX,y:this.mouseY},i.from,i.to));this.connections=this.connections.filter(i=>!t.includes(i)),t.forEach(i=>{this.units.forEach(n=>{n.source===i.from&&n.target===i.to&&n.active&&n.hitTarget()})})}this.isDragging=!1,this.isCutting=!1,this.dragStartNode=null}createConnection(e,t){if(this.connections.find(s=>s.from===e&&s.to===t))return;const n=this.connections.find(s=>s.from===t&&s.to===e);this.connections.filter(s=>s.from===e).length>=e.maxConnections||(n&&(this.connections=this.connections.filter(s=>s!==n)),E(()=>import("./Connection-kHgCJPxU.js"),__vite__mapDeps([0,1])).then(s=>{const r=s.Connection;this.connections.push(new r(e,t))}))}linesIntersect(e,t,i,n){const o=(t.x-e.x)*(n.y-i.y)-(n.x-i.x)*(t.y-e.y);if(o===0)return!1;const s=((n.y-i.y)*(n.x-e.x)+(i.x-n.x)*(n.y-e.y))/o,r=((e.y-t.y)*(n.x-e.x)+(t.x-e.x)*(n.y-e.y))/o;return 0<s&&s<1&&0<r&&r<1}}class f{constructor(e,t,i="neutral"){return this.x=e,this.y=t,this.owner=i,this.value=10,this.capacity=50,this.radius=30,this.level=1,this.generationRate=1,this.maxConnections=1,this.timer=0,this.colors={player:"#00ff9d",enemy:"#ff3333",neutral:"#888888"},dx*dx+dy*dy<=this.radius*this.radius}}const C=document.getElementById("gameCanvas"),l=new S(C);l.nodes.push(new f(200,300,"player"));l.nodes.push(new f(600,300,"enemy"));l.nodes.push(new f(400,150,"neutral"));l.nodes.push(new f(400,450,"neutral"));l.nodes[0].value=10;l.start();export{E as _};
