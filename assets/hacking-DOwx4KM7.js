import"./modulepreload-polyfill-B5Qt9EMX.js";import{X as we,R as O,T as v,D as x,Y as C,k as u,Z as _,_ as ve,w,$ as B,a0 as oe,h as y,a1 as j,a2 as _e,I as he,a3 as be,a4 as R,m as M,M as Te,a5 as k,a6 as Ee,d as $,v as N,n as T,p as ce,o as X,q as Ie,A as Se}from"./index-DnJsA0dy.js";import{A as Ce,B as q}from"./BitmapFontManager-C021P1L-.js";class le extends Ce{constructor(e,t){super();const{textures:s,data:r}=e;Object.keys(r.pages).forEach(a=>{const o=r.pages[parseInt(a,10)],n=s[o.id];this.pages.push({texture:n})}),Object.keys(r.chars).forEach(a=>{const o=r.chars[a],{frame:n,source:h,rotate:c}=s[o.page],f=we.transformRectCoords(o,n,c,new O),l=new v({frame:f,orig:new O(0,0,o.width,o.height),source:h,rotate:c});this.chars[a]={id:a.codePointAt(0),xOffset:o.xOffset,yOffset:o.yOffset,xAdvance:o.xAdvance,kerning:o.kerning??{},texture:l}}),this.baseRenderedFontSize=r.fontSize,this.baseMeasurementFontSize=r.fontSize,this.fontMetrics={ascent:0,descent:0,fontSize:r.fontSize},this.baseLineOffset=r.baseLineOffset,this.lineHeight=r.lineHeight,this.fontFamily=r.fontFamily,this.distanceField=r.distanceField??{type:"none",range:0},this.url=t}destroy(){super.destroy();for(let e=0;e<this.pages.length;e++){const{texture:t}=this.pages[e];t.destroy(!0)}this.pages=null}static install(e){q.install(e)}static uninstall(e){q.uninstall(e)}}const V={test(i){return typeof i=="string"&&i.startsWith("info face=")},parse(i){const e=i.match(/^[a-z]+\s+.+$/gm),t={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const l in e){const d=e[l].match(/^[a-z]+/gm)[0],p=e[l].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),g={};for(const m in p){const A=p[m].split("="),b=A[0],F=A[1].replace(/"/gm,""),Z=parseFloat(F),Ae=isNaN(Z)?F:Z;g[b]=Ae}t[d].push(g)}const s={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[r]=t.info,[a]=t.common,[o]=t.distanceField??[];o&&(s.distanceField={range:parseInt(o.distanceRange,10),type:o.fieldType}),s.fontSize=parseInt(r.size,10),s.fontFamily=r.face,s.lineHeight=parseInt(a.lineHeight,10);const n=t.page;for(let l=0;l<n.length;l++)s.pages.push({id:parseInt(n[l].id,10)||0,file:n[l].file});const h={};s.baseLineOffset=s.lineHeight-parseInt(a.base,10);const c=t.char;for(let l=0;l<c.length;l++){const d=c[l],p=parseInt(d.id,10);let g=d.letter??d.char??String.fromCharCode(p);g==="space"&&(g=" "),h[p]=g,s.chars[g]={id:p,page:parseInt(d.page,10)||0,x:parseInt(d.x,10),y:parseInt(d.y,10),width:parseInt(d.width,10),height:parseInt(d.height,10),xOffset:parseInt(d.xoffset,10),yOffset:parseInt(d.yoffset,10),xAdvance:parseInt(d.xadvance,10),kerning:{}}}const f=t.kerning||[];for(let l=0;l<f.length;l++){const d=parseInt(f[l].first,10),p=parseInt(f[l].second,10),g=parseInt(f[l].amount,10);s.chars[h[p]].kerning[h[d]]=g}return s}},ee={test(i){const e=i;return typeof e!="string"&&"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&e.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(i){const e={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},t=i.getElementsByTagName("info")[0],s=i.getElementsByTagName("common")[0],r=i.getElementsByTagName("distanceField")[0];r&&(e.distanceField={type:r.getAttribute("fieldType"),range:parseInt(r.getAttribute("distanceRange"),10)});const a=i.getElementsByTagName("page"),o=i.getElementsByTagName("char"),n=i.getElementsByTagName("kerning");e.fontSize=parseInt(t.getAttribute("size"),10),e.fontFamily=t.getAttribute("face"),e.lineHeight=parseInt(s.getAttribute("lineHeight"),10);for(let c=0;c<a.length;c++)e.pages.push({id:parseInt(a[c].getAttribute("id"),10)||0,file:a[c].getAttribute("file")});const h={};e.baseLineOffset=e.lineHeight-parseInt(s.getAttribute("base"),10);for(let c=0;c<o.length;c++){const f=o[c],l=parseInt(f.getAttribute("id"),10);let d=f.getAttribute("letter")??f.getAttribute("char")??String.fromCharCode(l);d==="space"&&(d=" "),h[l]=d,e.chars[d]={id:l,page:parseInt(f.getAttribute("page"),10)||0,x:parseInt(f.getAttribute("x"),10),y:parseInt(f.getAttribute("y"),10),width:parseInt(f.getAttribute("width"),10),height:parseInt(f.getAttribute("height"),10),xOffset:parseInt(f.getAttribute("xoffset"),10),yOffset:parseInt(f.getAttribute("yoffset"),10),xAdvance:parseInt(f.getAttribute("xadvance"),10),kerning:{}}}for(let c=0;c<n.length;c++){const f=parseInt(n[c].getAttribute("first"),10),l=parseInt(n[c].getAttribute("second"),10),d=parseInt(n[c].getAttribute("amount"),10);e.chars[h[l]].kerning[h[f]]=d}return e}},te={test(i){return typeof i=="string"&&i.match(/<font(\s|>)/)?ee.test(x.get().parseXML(i)):!1},parse(i){return ee.parse(x.get().parseXML(i))}},Le=[".xml",".fnt"],Pe={extension:{type:u.CacheParser,name:"cacheBitmapFont"},test:i=>i instanceof le,getCacheableAssets(i,e){const t={};return i.forEach(s=>{t[s]=e,t[`${s}-bitmap`]=e}),t[`${e.fontFamily}-bitmap`]=e,t}},ke={extension:{type:u.LoadParser,priority:C.Normal},name:"loadBitmapFont",id:"bitmap-font",test(i){return Le.includes(_.extname(i).toLowerCase())},async testParse(i){return V.test(i)||te.test(i)},async parse(i,e,t){const s=V.test(i)?V.parse(i):te.parse(i),{src:r}=e,{pages:a}=s,o=[],n=s.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let l=0;l<a.length;++l){const d=a[l].file;let p=_.join(_.dirname(r),d);p=ve(p,r),o.push({src:p,data:n})}const h=await t.load(o),c=o.map(l=>h[l.src]);return new le({data:s,textures:c},r)},async load(i,e){return await(await x.get().fetch(i)).text()},async unload(i,e,t){await Promise.all(i.pages.map(s=>t.unload(s.texture.source._sourceOrigin))),i.destroy()}};class Be{constructor(e,t=!1){this._loader=e,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=t}add(e){e.forEach(t=>{this._assetList.push(t)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const e=[],t=Math.min(this._assetList.length,this._maxConcurrent);for(let s=0;s<t;s++)e.push(this._assetList.pop());await this._loader.load(e),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(e){this._isActive!==e&&(this._isActive=e,e&&!this._isLoading&&this._next())}}const Me={extension:{type:u.CacheParser,name:"cacheTextureArray"},test:i=>Array.isArray(i)&&i.every(e=>e instanceof v),getCacheableAssets:(i,e)=>{const t={};return i.forEach(s=>{e.forEach((r,a)=>{t[s+(a===0?"":a+1)]=r})}),t}};async function de(i){if("Image"in globalThis)return new Promise(e=>{const t=new Image;t.onload=()=>{e(!0)},t.onerror=()=>{e(!1)},t.src=i});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const e=await(await fetch(i)).blob();await createImageBitmap(e)}catch{return!1}return!0}return!1}const Oe={extension:{type:u.DetectionParser,priority:1},test:async()=>de("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async i=>[...i,"avif"],remove:async i=>i.filter(e=>e!=="avif")},se=["png","jpg","jpeg"],Fe={extension:{type:u.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async i=>[...i,...se],remove:async i=>i.filter(e=>!se.includes(e))},Re="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function D(i){return Re?!1:document.createElement("video").canPlayType(i)!==""}const We={extension:{type:u.DetectionParser,priority:0},test:async()=>D("video/mp4"),add:async i=>[...i,"mp4","m4v"],remove:async i=>i.filter(e=>e!=="mp4"&&e!=="m4v")},Ue={extension:{type:u.DetectionParser,priority:0},test:async()=>D("video/ogg"),add:async i=>[...i,"ogv"],remove:async i=>i.filter(e=>e!=="ogv")},je={extension:{type:u.DetectionParser,priority:0},test:async()=>D("video/webm"),add:async i=>[...i,"webm"],remove:async i=>i.filter(e=>e!=="webm")},De={extension:{type:u.DetectionParser,priority:0},test:async()=>de("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async i=>[...i,"webp"],remove:async i=>i.filter(e=>e!=="webp")},fe=class W{constructor(){this.loadOptions={...W.defaultOptions},this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(e,t,s)=>(this._parsersValidated=!1,e[t]=s,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(e,t){const s={promise:null,parser:null};return s.promise=(async()=>{let r=null,a=null;if((t.parser||t.loadParser)&&(a=this._parserHash[t.parser||t.loadParser],t.loadParser&&w(`[Assets] "loadParser" is deprecated, use "parser" instead for ${e}`),a||w(`[Assets] specified load parser "${t.parser||t.loadParser}" not found while loading ${e}`)),!a){for(let o=0;o<this.parsers.length;o++){const n=this.parsers[o];if(n.load&&n.test?.(e,t,this)){a=n;break}}if(!a)return w(`[Assets] ${e} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}r=await a.load(e,t,this),s.parser=a;for(let o=0;o<this.parsers.length;o++){const n=this.parsers[o];n.parse&&n.parse&&await n.testParse?.(r,t,this)&&(r=await n.parse(r,t,this)||r,s.parser=n)}return r})(),s}async load(e,t){this._parsersValidated||this._validateParsers();const s=typeof t=="function"?{...W.defaultOptions,...this.loadOptions,onProgress:t}:{...W.defaultOptions,...this.loadOptions,...t||{}},{onProgress:r,onError:a,strategy:o,retryCount:n,retryDelay:h}=s;let c=0;const f={},l=oe(e),d=B(e,m=>({alias:[m],src:m,data:{}})),p=d.reduce((m,A)=>m+(A.progressSize||1),0),g=d.map(async m=>{const A=_.toAbsolute(m.src);f[m.src]||(await this._loadAssetWithRetry(A,m,{onProgress:r,onError:a,strategy:o,retryCount:n,retryDelay:h},f),c+=m.progressSize||1,r&&r(c/p))});return await Promise.all(g),l?f[d[0].src]:f}async unload(e){const s=B(e,r=>({alias:[r],src:r})).map(async r=>{const a=_.toAbsolute(r.src),o=this.promiseCache[a];if(o){const n=await o.promise;delete this.promiseCache[a],await o.parser?.unload?.(n,r,this)}});await Promise.all(s)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(e=>e.name||e.id).reduce((e,t)=>(!t.name&&!t.id?w("[Assets] parser should have an id"):(e[t.name]||e[t.id])&&w(`[Assets] parser id conflict "${t.id}"`),e[t.name]=t,t.id&&(e[t.id]=t),e),{})}async _loadAssetWithRetry(e,t,s,r){let a=0;const{onError:o,strategy:n,retryCount:h,retryDelay:c}=s,f=l=>new Promise(d=>setTimeout(d,l));for(;;)try{this.promiseCache[e]||(this.promiseCache[e]=this._getLoadPromiseAndParser(e,t)),r[t.src]=await this.promiseCache[e].promise;return}catch(l){delete this.promiseCache[e],delete r[t.src],a++;const d=n!=="retry"||a>h;if(n==="retry"&&!d){o&&o(l,t),await f(c);continue}if(n==="skip"){o&&o(l,t);return}throw o&&o(l,t),new Error(`[Loader.load] Failed to load ${e}.
${l}`)}}};fe.defaultOptions={onProgress:void 0,onError:void 0,strategy:"throw",retryCount:3,retryDelay:250};let $e=fe;function L(i,e){if(Array.isArray(e)){for(const t of e)if(i.startsWith(`data:${t}`))return!0;return!1}return i.startsWith(`data:${e}`)}function P(i,e){const t=i.split("?")[0],s=_.extname(t).toLowerCase();return Array.isArray(e)?e.includes(s):s===e}const Ne=".json",Ve="application/json",Ge={extension:{type:u.LoadParser,priority:C.Low},name:"loadJson",id:"json",test(i){return L(i,Ve)||P(i,Ne)},async load(i){return await(await x.get().fetch(i)).json()}},ze=".txt",He="text/plain",Xe={name:"loadTxt",id:"text",extension:{type:u.LoadParser,priority:C.Low,name:"loadTxt"},test(i){return L(i,He)||P(i,ze)},async load(i){return await(await x.get().fetch(i)).text()}},Ye=["normal","bold","100","200","300","400","500","600","700","800","900"],Ke=[".ttf",".otf",".woff",".woff2"],Qe=["font/ttf","font/otf","font/woff","font/woff2"],Je=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function Ze(i){const e=_.extname(i),r=_.basename(i,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map(n=>n.charAt(0).toUpperCase()+n.slice(1));let a=r.length>0;for(const n of r)if(!n.match(Je)){a=!1;break}let o=r.join(" ");return a||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}const qe=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function et(i){return qe.test(i)?i:encodeURI(i)}const tt={extension:{type:u.LoadParser,priority:C.Low},name:"loadWebFont",id:"web-font",test(i){return L(i,Qe)||P(i,Ke)},async load(i,e){const t=x.get().getFontFaceSet();if(t){const s=[],r=e.data?.family??Ze(i),a=e.data?.weights?.filter(n=>Ye.includes(n))??["normal"],o=e.data??{};for(let n=0;n<a.length;n++){const h=a[n],c=new FontFace(r,`url(${et(i)})`,{...o,weight:h});await c.load(),t.add(c),s.push(c)}return y.has(`${r}-and-url`)?y.get(`${r}-and-url`).entries.push({url:i,faces:s}):y.set(`${r}-and-url`,{entries:[{url:i,faces:s}]}),s.length===1?s[0]:s}return w("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(i){const e=Array.isArray(i)?i:[i],t=e[0].family,s=y.get(`${t}-and-url`),r=s.entries.find(a=>a.faces.some(o=>e.indexOf(o)!==-1));r.faces=r.faces.filter(a=>e.indexOf(a)===-1),r.faces.length===0&&(s.entries=s.entries.filter(a=>a!==r)),e.forEach(a=>{x.get().getFontFaceSet().delete(a)}),s.entries.length===0&&y.remove(`${t}-and-url`)}};function K(i,e=1){const t=j.RETINA_PREFIX?.exec(i);return t?parseFloat(t[1]):e}function Q(i,e,t){i.label=t,i._sourceOrigin=t;const s=new v({source:i,label:t}),r=()=>{delete e.promiseCache[t],y.has(t)&&y.remove(t)};return s.source.once("destroy",()=>{e.promiseCache[t]&&(w("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),r())}),s.once("destroy",()=>{i.destroyed||(w("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),r())}),s}const st=".svg",it="image/svg+xml",rt={extension:{type:u.LoadParser,priority:C.Low,name:"loadSVG"},name:"loadSVG",id:"svg",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test(i){return L(i,it)||P(i,st)},async load(i,e,t){return e.data?.parseAsGraphicsContext??this.config.parseAsGraphicsContext?nt(i):at(i,e,t,this.config.crossOrigin)},unload(i){i.destroy(!0)}};async function at(i,e,t,s){const r=await x.get().fetch(i),a=x.get().createImage();a.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(await r.text())}`,a.crossOrigin=s,await a.decode();const o=e.data?.width??a.width,n=e.data?.height??a.height,h=e.data?.resolution||K(i),c=Math.ceil(o*h),f=Math.ceil(n*h),l=x.get().createCanvas(c,f),d=l.getContext("2d");d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high",d.drawImage(a,0,0,o*h,n*h);const{parseAsGraphicsContext:p,...g}=e.data??{},m=new he({resource:l,alphaMode:"premultiply-alpha-on-upload",resolution:h,...g});return Q(m,t,i)}async function nt(i){const t=await(await x.get().fetch(i)).text(),s=new _e;return s.svg(t),s}const ot=`(function () {
    'use strict';

    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
    async function checkImageBitmap() {
      try {
        if (typeof createImageBitmap !== "function")
          return false;
        const response = await fetch(WHITE_PNG);
        const imageBlob = await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);
        return imageBitmap.width === 1 && imageBitmap.height === 1;
      } catch (_e) {
        return false;
      }
    }
    void checkImageBitmap().then((result) => {
      self.postMessage(result);
    });

})();
`;let I=null,Y=class{constructor(){I||(I=URL.createObjectURL(new Blob([ot],{type:"application/javascript"}))),this.worker=new Worker(I)}};Y.revokeObjectURL=function(){I&&(URL.revokeObjectURL(I),I=null)};const ht=`(function () {
    'use strict';

    async function loadImageBitmap(url, alphaMode) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
      }
      const imageBlob = await response.blob();
      return alphaMode === "premultiplied-alpha" ? createImageBitmap(imageBlob, { premultiplyAlpha: "none" }) : createImageBitmap(imageBlob);
    }
    self.onmessage = async (event) => {
      try {
        const imageBitmap = await loadImageBitmap(event.data.data[0], event.data.data[1]);
        self.postMessage({
          data: imageBitmap,
          uuid: event.data.uuid,
          id: event.data.id
        }, [imageBitmap]);
      } catch (e) {
        self.postMessage({
          error: e,
          uuid: event.data.uuid,
          id: event.data.id
        });
      }
    };

})();
`;let S=null;class pe{constructor(){S||(S=URL.createObjectURL(new Blob([ht],{type:"application/javascript"}))),this.worker=new Worker(S)}}pe.revokeObjectURL=function(){S&&(URL.revokeObjectURL(S),S=null)};let ie=0,G;class ct{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(e=>{const{worker:t}=new Y;t.addEventListener("message",s=>{t.terminate(),Y.revokeObjectURL(),e(s.data)})}),this._isImageBitmapSupported)}loadImageBitmap(e,t){return this._run("loadImageBitmap",[e,t?.data?.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){G===void 0&&(G=navigator.hardwareConcurrency||4);let e=this._workerPool.pop();return!e&&this._createdWorkers<G&&(this._createdWorkers++,e=new pe().worker,e.addEventListener("message",t=>{this._complete(t.data),this._returnWorker(t.target),this._next()})),e}_returnWorker(e){this._workerPool.push(e)}_complete(e){this._resolveHash[e.uuid]&&(e.error!==void 0?this._resolveHash[e.uuid].reject(e.error):this._resolveHash[e.uuid].resolve(e.data),delete this._resolveHash[e.uuid])}async _run(e,t){await this._initWorkers();const s=new Promise((r,a)=>{this._queue.push({id:e,arguments:t,resolve:r,reject:a})});return this._next(),s}_next(){if(!this._queue.length)return;const e=this._getWorker();if(!e)return;const t=this._queue.pop(),s=t.id;this._resolveHash[ie]={resolve:t.resolve,reject:t.reject},e.postMessage({data:t.arguments,uuid:ie++,id:s})}reset(){this._workerPool.forEach(e=>e.terminate()),this._workerPool.length=0,Object.values(this._resolveHash).forEach(({reject:e})=>{e?.(new Error("WorkerManager has been reset before completion"))}),this._resolveHash={},this._queue.length=0,this._initialized=!1,this._createdWorkers=0}}const re=new ct,lt=[".jpeg",".jpg",".png",".webp",".avif"],dt=["image/jpeg","image/png","image/webp","image/avif"];async function ft(i,e){const t=await x.get().fetch(i);if(!t.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${t.status} ${t.statusText}`);const s=await t.blob();return e?.data?.alphaMode==="premultiplied-alpha"?createImageBitmap(s,{premultiplyAlpha:"none"}):createImageBitmap(s)}const ue={name:"loadTextures",id:"texture",extension:{type:u.LoadParser,priority:C.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(i){return L(i,dt)||P(i,lt)},async load(i,e,t){let s=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await re.isImageBitmapSupported()?s=await re.loadImageBitmap(i,e):s=await ft(i,e):s=await new Promise((a,o)=>{s=x.get().createImage(),s.crossOrigin=this.config.crossOrigin,s.src=i,s.complete?a(s):(s.onload=()=>{a(s)},s.onerror=o)});const r=new he({resource:s,alphaMode:"premultiply-alpha-on-upload",resolution:e.data?.resolution||K(i),...e.data});return Q(r,t,i)},unload(i){i.destroy(!0)}},pt=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"];let z,H;function ut(i,e,t){t===void 0&&!e.startsWith("data:")?i.crossOrigin=mt(e):t!==!1&&(i.crossOrigin=typeof t=="string"?t:"anonymous")}function gt(i){return new Promise((e,t)=>{i.addEventListener("canplaythrough",s),i.addEventListener("error",r),i.load();function s(){a(),e()}function r(o){a(),t(o)}function a(){i.removeEventListener("canplaythrough",s),i.removeEventListener("error",r)}})}function mt(i,e=globalThis.location){if(i.startsWith("data:"))return"";e||(e=globalThis.location);const t=new URL(i,document.baseURI);return t.hostname!==e.hostname||t.port!==e.port||t.protocol!==e.protocol?"anonymous":""}function yt(){const i=[],e=[];for(const t of pt){const s=R.MIME_TYPES[t.substring(1)]||`video/${t.substring(1)}`;D(s)&&(i.push(t),e.includes(s)||e.push(s))}return{validVideoExtensions:i,validVideoMime:e}}const xt={name:"loadVideo",id:"video",extension:{type:u.LoadParser,name:"loadVideo"},test(i){if(!z||!H){const{validVideoExtensions:s,validVideoMime:r}=yt();z=s,H=r}const e=L(i,H),t=P(i,z);return e||t},async load(i,e,t){const s={...R.defaultOptions,resolution:e.data?.resolution||K(i),alphaMode:e.data?.alphaMode||await be(),...e.data},r=document.createElement("video"),a={preload:s.autoLoad!==!1?"auto":void 0,"webkit-playsinline":s.playsinline!==!1?"":void 0,playsinline:s.playsinline!==!1?"":void 0,muted:s.muted===!0?"":void 0,loop:s.loop===!0?"":void 0,autoplay:s.autoPlay!==!1?"":void 0};Object.keys(a).forEach(h=>{const c=a[h];c!==void 0&&r.setAttribute(h,c)}),s.muted===!0&&(r.muted=!0),ut(r,i,s.crossorigin);const o=document.createElement("source");let n;if(s.mime)n=s.mime;else if(i.startsWith("data:"))n=i.slice(5,i.indexOf(";"));else if(!i.startsWith("blob:")){const h=i.split("?")[0].slice(i.lastIndexOf(".")+1).toLowerCase();n=R.MIME_TYPES[h]||`video/${h}`}return o.src=i,n&&(o.type=n),new Promise(h=>{const c=async()=>{const f=new R({...s,resource:r});r.removeEventListener("canplay",c),e.data.preload&&await gt(r),h(Q(f,t,i))};s.preload&&!s.autoPlay&&r.load(),r.addEventListener("canplay",c),r.appendChild(o)})},unload(i){i.destroy(!0)}},ge={extension:{type:u.ResolveParser,name:"resolveTexture"},test:ue.test,parse:i=>({resolution:parseFloat(j.RETINA_PREFIX.exec(i)?.[1]??"1"),format:i.split(".").pop(),src:i})},At={extension:{type:u.ResolveParser,priority:-2,name:"resolveJson"},test:i=>j.RETINA_PREFIX.test(i)&&i.endsWith(".json"),parse:ge.parse};class wt{constructor(){this._detections=[],this._initialized=!1,this.resolver=new j,this.loader=new $e,this.cache=y,this._backgroundLoader=new Be(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(e={}){if(this._initialized){w("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,e.defaultSearchParams&&this.resolver.setDefaultSearchParams(e.defaultSearchParams),e.basePath&&(this.resolver.basePath=e.basePath),e.bundleIdentifier&&this.resolver.setBundleIdentifier(e.bundleIdentifier),e.manifest){let a=e.manifest;typeof a=="string"&&(a=await this.load(a)),this.resolver.addManifest(a)}const t=e.texturePreference?.resolution??1,s=typeof t=="number"?[t]:t,r=await this._detectFormats({preferredFormats:e.texturePreference?.format,skipDetections:e.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:r,resolution:s}}),e.preferences&&this.setPreferences(e.preferences),e.loadOptions&&(this.loader.loadOptions={...this.loader.loadOptions,...e.loadOptions})}add(e){this.resolver.add(e)}async load(e,t){this._initialized||await this.init();const s=oe(e),r=B(e).map(n=>{if(typeof n!="string"){const h=this.resolver.getAlias(n);return h.some(c=>!this.resolver.hasKey(c))&&this.add(n),Array.isArray(h)?h[0]:h}return this.resolver.hasKey(n)||this.add({alias:n,src:n}),n}),a=this.resolver.resolve(r),o=await this._mapLoadToResolve(a,t);return s?o[r[0]]:o}addBundle(e,t){this.resolver.addBundle(e,t)}async loadBundle(e,t){this._initialized||await this.init();let s=!1;typeof e=="string"&&(s=!0,e=[e]);const r=this.resolver.resolveBundle(e),a={},o=Object.keys(r);let n=0;const h=[],c=()=>{t?.(h.reduce((l,d)=>l+d,0)/n)},f=o.map((l,d)=>{const p=r[l],g=Object.values(p),A=[...new Set(g.flat())].reduce((b,F)=>b+(F.progressSize||1),0);return h.push(0),n+=A,this._mapLoadToResolve(p,b=>{h[d]=b*A,c()}).then(b=>{a[l]=b})});return await Promise.all(f),s?a[e[0]]:a}async backgroundLoad(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolve(e);this._backgroundLoader.add(Object.values(t))}async backgroundLoadBundle(e){this._initialized||await this.init(),typeof e=="string"&&(e=[e]);const t=this.resolver.resolveBundle(e);Object.values(t).forEach(s=>{this._backgroundLoader.add(Object.values(s))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(e){if(typeof e=="string")return y.get(e);const t={};for(let s=0;s<e.length;s++)t[s]=y.get(e[s]);return t}async _mapLoadToResolve(e,t){const s=[...new Set(Object.values(e))];this._backgroundLoader.active=!1;const r=await this.loader.load(s,t);this._backgroundLoader.active=!0;const a={};return s.forEach(o=>{const n=r[o.src],h=[o.src];o.alias&&h.push(...o.alias),h.forEach(c=>{a[c]=n}),y.set(h,n)}),a}async unload(e){this._initialized||await this.init();const t=B(e).map(r=>typeof r!="string"?r.src:r),s=this.resolver.resolve(t);await this._unloadFromResolved(s)}async unloadBundle(e){this._initialized||await this.init(),e=B(e);const t=this.resolver.resolveBundle(e),s=Object.keys(t).map(r=>this._unloadFromResolved(t[r]));await Promise.all(s)}async _unloadFromResolved(e){const t=Object.values(e);t.forEach(s=>{y.remove(s.src)}),await this.loader.unload(t)}async _detectFormats(e){let t=[];e.preferredFormats&&(t=Array.isArray(e.preferredFormats)?e.preferredFormats:[e.preferredFormats]);for(const s of e.detections)e.skipDetections||await s.test()?t=await s.add(t):e.skipDetections||(t=await s.remove(t));return t=t.filter((s,r)=>t.indexOf(s)===r),t}get detections(){return this._detections}setPreferences(e){this.loader.parsers.forEach(t=>{t.config&&Object.keys(t.config).filter(s=>s in e).forEach(s=>{t.config[s]=e[s]})})}}const E=new wt;M.handleByList(u.LoadParser,E.loader.parsers).handleByList(u.ResolveParser,E.resolver.parsers).handleByList(u.CacheParser,E.cache.parsers).handleByList(u.DetectionParser,E.detections);M.add(Me,Fe,Oe,De,We,Ue,je,Ge,Xe,tt,rt,ue,xt,ke,Pe,ge,At);const ae={loader:u.LoadParser,resolver:u.ResolveParser,cache:u.CacheParser,detection:u.DetectionParser};M.handle(u.Asset,i=>{const e=i.ref;Object.entries(ae).filter(([t])=>!!e[t]).forEach(([t,s])=>M.add(Object.assign(e[t],{extension:e[t].extension??s})))},i=>{const e=i.ref;Object.keys(ae).filter(t=>!!e[t]).forEach(t=>M.remove(e[t]))});class vt{constructor({matrix:e,observer:t}={}){this.dirty=!0,this._matrix=e??new Te,this.observer=t,this.position=new k(this,0,0),this.scale=new k(this,1,1),this.pivot=new k(this,0,0),this.skew=new k(this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1}get matrix(){const e=this._matrix;return this.dirty&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this.dirty=!1),e}_onUpdate(e){this.dirty=!0,e===this.skew&&this.updateSkew(),this.observer?._onUpdate(this)}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this.dirty=!0}toString(){return`[pixi.js/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}setFromMatrix(e){e.decompose(this),this.dirty=!0}get rotation(){return this._rotation}set rotation(e){this._rotation!==e&&(this._rotation=e,this._onUpdate(this.skew))}}const me=class U extends Ee{constructor(...e){let t=e[0]||{};t instanceof v&&(t={texture:t}),e.length>1&&($(N,"use new TilingSprite({ texture, width:100, height:100 }) instead"),t.width=e[1],t.height=e[2]),t={...U.defaultOptions,...t};const{texture:s,anchor:r,tilePosition:a,tileScale:o,tileRotation:n,width:h,height:c,applyAnchorToTexture:f,roundPixels:l,...d}=t??{};super({label:"TilingSprite",...d}),this.renderPipeId="tilingSprite",this.batched=!0,this.allowChildren=!1,this._anchor=new k({_onUpdate:()=>{this.onViewUpdate()}}),this.applyAnchorToTexture=f,this.texture=s,this._width=h??s.width,this._height=c??s.height,this._tileTransform=new vt({observer:{_onUpdate:()=>this.onViewUpdate()}}),r&&(this.anchor=r),this.tilePosition=a,this.tileScale=o,this.tileRotation=n,this.roundPixels=l??!1}static from(e,t={}){return typeof e=="string"?new U({texture:y.get(e),...t}):new U({texture:e,...t})}get uvRespectAnchor(){return $(N,"uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture}set uvRespectAnchor(e){$(N,"uvRespectAnchor is deprecated, please use applyAnchorToTexture instead"),this.applyAnchorToTexture=e}get clampMargin(){return this._texture.textureMatrix.clampMargin}set clampMargin(e){this._texture.textureMatrix.clampMargin=e}get anchor(){return this._anchor}set anchor(e){typeof e=="number"?this._anchor.set(e):this._anchor.copyFrom(e)}get tilePosition(){return this._tileTransform.position}set tilePosition(e){this._tileTransform.position.copyFrom(e)}get tileScale(){return this._tileTransform.scale}set tileScale(e){typeof e=="number"?this._tileTransform.scale.set(e):this._tileTransform.scale.copyFrom(e)}set tileRotation(e){this._tileTransform.rotation=e}get tileRotation(){return this._tileTransform.rotation}get tileTransform(){return this._tileTransform}set texture(e){e||(e=v.EMPTY);const t=this._texture;t!==e&&(t&&t.dynamic&&t.off("update",this.onViewUpdate,this),e.dynamic&&e.on("update",this.onViewUpdate,this),this._texture=e,this.onViewUpdate())}get texture(){return this._texture}set width(e){this._width=e,this.onViewUpdate()}get width(){return this._width}set height(e){this._height=e,this.onViewUpdate()}get height(){return this._height}setSize(e,t){typeof e=="object"&&(t=e.height??e.width,e=e.width),this._width=e,this._height=t??e,this.onViewUpdate()}getSize(e){return e||(e={}),e.width=this._width,e.height=this._height,e}updateBounds(){const e=this._bounds,t=this._anchor,s=this._width,r=this._height;e.minX=-t._x*s,e.maxX=e.minX+s,e.minY=-t._y*r,e.maxY=e.minY+r}containsPoint(e){const t=this._width,s=this._height,r=-t*this._anchor._x;let a=0;return e.x>=r&&e.x<=r+t&&(a=-s*this._anchor._y,e.y>=a&&e.y<=a+s)}destroy(e=!1){if(super.destroy(e),this._anchor=null,this._tileTransform=null,this._bounds=null,typeof e=="boolean"?e:e?.texture){const s=typeof e=="boolean"?e:e?.textureSource;this._texture.destroy(s)}this._texture=null}};me.defaultOptions={texture:v.EMPTY,anchor:{x:0,y:0},tilePosition:{x:0,y:0},tileScale:{x:1,y:1},tileRotation:0,applyAnchorToTexture:!1};let _t=me;const bt="/kross_games/assets/sprites-BLfl1JFh.svg",Tt="data:image/svg+xml,%3csvg%20width='96'%20height='32'%20viewBox='0%200%2096%2032'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3crect%20id='p'%20width='2'%20height='2'%20fill='%23FFFFFF'/%3e%3c/defs%3e%3cg%20id='frame1'%3e%3cuse%20href='%23p'%20x='0'%20y='14'/%3e%3cuse%20href='%23p'%20x='2'%20y='14'/%3e%3cuse%20href='%23p'%20x='0'%20y='16'/%3e%3cuse%20href='%23p'%20x='2'%20y='16'/%3e%3cuse%20href='%23p'%20x='4'%20y='12'/%3e%3cuse%20href='%23p'%20x='6'%20y='12'/%3e%3cuse%20href='%23p'%20x='4'%20y='14'/%3e%3cuse%20href='%23p'%20x='6'%20y='14'/%3e%3cuse%20href='%23p'%20x='8'%20y='10'/%3e%3cuse%20href='%23p'%20x='10'%20y='10'/%3e%3cuse%20href='%23p'%20x='8'%20y='12'/%3e%3cuse%20href='%23p'%20x='10'%20y='12'/%3e%3cuse%20href='%23p'%20x='12'%20y='12'/%3e%3cuse%20href='%23p'%20x='14'%20y='12'/%3e%3cuse%20href='%23p'%20x='12'%20y='14'/%3e%3cuse%20href='%23p'%20x='14'%20y='14'/%3e%3cuse%20href='%23p'%20x='16'%20y='14'/%3e%3cuse%20href='%23p'%20x='18'%20y='14'/%3e%3cuse%20href='%23p'%20x='16'%20y='16'/%3e%3cuse%20href='%23p'%20x='18'%20y='16'/%3e%3cuse%20href='%23p'%20x='20'%20y='16'/%3e%3cuse%20href='%23p'%20x='22'%20y='16'/%3e%3cuse%20href='%23p'%20x='20'%20y='18'/%3e%3cuse%20href='%23p'%20x='22'%20y='18'/%3e%3cuse%20href='%23p'%20x='24'%20y='18'/%3e%3cuse%20href='%23p'%20x='26'%20y='18'/%3e%3cuse%20href='%23p'%20x='24'%20y='20'/%3e%3cuse%20href='%23p'%20x='26'%20y='20'/%3e%3cuse%20href='%23p'%20x='28'%20y='16'/%3e%3cuse%20href='%23p'%20x='30'%20y='16'/%3e%3cuse%20href='%23p'%20x='28'%20y='18'/%3e%3cuse%20href='%23p'%20x='30'%20y='18'/%3e%3c/g%3e%3cg%20id='frame2'%20transform='translate(32,%200)'%3e%3cuse%20href='%23p'%20x='0'%20y='18'/%3e%3cuse%20href='%23p'%20x='2'%20y='18'/%3e%3cuse%20href='%23p'%20x='0'%20y='20'/%3e%3cuse%20href='%23p'%20x='2'%20y='20'/%3e%3cuse%20href='%23p'%20x='4'%20y='16'/%3e%3cuse%20href='%23p'%20x='6'%20y='16'/%3e%3cuse%20href='%23p'%20x='4'%20y='18'/%3e%3cuse%20href='%23p'%20x='6'%20y='18'/%3e%3cuse%20href='%23p'%20x='8'%20y='14'/%3e%3cuse%20href='%23p'%20x='10'%20y='14'/%3e%3cuse%20href='%23p'%20x='8'%20y='16'/%3e%3cuse%20href='%23p'%20x='10'%20y='16'/%3e%3cuse%20href='%23p'%20x='12'%20y='12'/%3e%3cuse%20href='%23p'%20x='14'%20y='12'/%3e%3cuse%20href='%23p'%20x='12'%20y='14'/%3e%3cuse%20href='%23p'%20x='14'%20y='14'/%3e%3cuse%20href='%23p'%20x='16'%20y='10'/%3e%3cuse%20href='%23p'%20x='18'%20y='10'/%3e%3cuse%20href='%23p'%20x='16'%20y='12'/%3e%3cuse%20href='%23p'%20x='18'%20y='12'/%3e%3cuse%20href='%23p'%20x='20'%20y='12'/%3e%3cuse%20href='%23p'%20x='22'%20y='12'/%3e%3cuse%20href='%23p'%20x='20'%20y='14'/%3e%3cuse%20href='%23p'%20x='22'%20y='14'/%3e%3cuse%20href='%23p'%20x='24'%20y='14'/%3e%3cuse%20href='%23p'%20x='26'%20y='14'/%3e%3cuse%20href='%23p'%20x='24'%20y='16'/%3e%3cuse%20href='%23p'%20x='26'%20y='16'/%3e%3cuse%20href='%23p'%20x='28'%20y='16'/%3e%3cuse%20href='%23p'%20x='30'%20y='16'/%3e%3cuse%20href='%23p'%20x='28'%20y='18'/%3e%3cuse%20href='%23p'%20x='30'%20y='18'/%3e%3c/g%3e%3cg%20id='frame3'%20transform='translate(64,%200)'%3e%3cuse%20href='%23p'%20x='0'%20y='12'/%3e%3cuse%20href='%23p'%20x='2'%20y='12'/%3e%3cuse%20href='%23p'%20x='0'%20y='14'/%3e%3cuse%20href='%23p'%20x='2'%20y='14'/%3e%3cuse%20href='%23p'%20x='4'%20y='14'/%3e%3cuse%20href='%23p'%20x='6'%20y='14'/%3e%3cuse%20href='%23p'%20x='4'%20y='16'/%3e%3cuse%20href='%23p'%20x='6'%20y='16'/%3e%3cuse%20href='%23p'%20x='8'%20y='16'/%3e%3cuse%20href='%23p'%20x='10'%20y='16'/%3e%3cuse%20href='%23p'%20x='8'%20y='18'/%3e%3cuse%20href='%23p'%20x='10'%20y='18'/%3e%3cuse%20href='%23p'%20x='12'%20y='18'/%3e%3cuse%20href='%23p'%20x='14'%20y='18'/%3e%3cuse%20href='%23p'%20x='12'%20y='20'/%3e%3cuse%20href='%23p'%20x='14'%20y='20'/%3e%3cuse%20href='%23p'%20x='16'%20y='16'/%3e%3cuse%20href='%23p'%20x='18'%20y='16'/%3e%3cuse%20href='%23p'%20x='16'%20y='18'/%3e%3cuse%20href='%23p'%20x='18'%20y='18'/%3e%3cuse%20href='%23p'%20x='20'%20y='14'/%3e%3cuse%20href='%23p'%20x='22'%20y='14'/%3e%3cuse%20href='%23p'%20x='20'%20y='16'/%3e%3cuse%20href='%23p'%20x='22'%20y='16'/%3e%3cuse%20href='%23p'%20x='24'%20y='12'/%3e%3cuse%20href='%23p'%20x='26'%20y='12'/%3e%3cuse%20href='%23p'%20x='24'%20y='14'/%3e%3cuse%20href='%23p'%20x='26'%20y='14'/%3e%3cuse%20href='%23p'%20x='28'%20y='10'/%3e%3cuse%20href='%23p'%20x='30'%20y='10'/%3e%3cuse%20href='%23p'%20x='28'%20y='12'/%3e%3cuse%20href='%23p'%20x='30'%20y='12'/%3e%3c/g%3e%3c/svg%3e";class Et{constructor(e,t,s="neutral",r){this.x=e,this.y=t,this.owner=s,this.lastOwner=s,this.value=10,this.capacity=60,this.radius=30,this.level=1,this.generationRate=1.1,this.maxConnections=1,this.timer=0,this.colors={player:65437,enemy:16724787,neutral:8947848},this.container=new T,this.container.x=e,this.container.y=t,this.graphics=new ce,this.container.addChild(this.graphics),this.spritesTexture=r,this.sprite=new X(this.getTextureFrame()),this.sprite.anchor.set(.5),this.sprite.width=64,this.sprite.height=64,this.container.addChild(this.sprite),this.text=new Ie({text:Math.floor(this.value),style:{fontFamily:"Courier New",fontSize:24,fontWeight:"bold",fill:16777215,stroke:{color:0,width:4}}}),this.text.anchor.set(.5),this.container.addChild(this.text),this.updateVisuals()}getTextureFrame(){let e=6;return this.owner==="player"?e=this.level-1:this.owner==="enemy"&&(e=3+(this.level-1)),new v({source:this.spritesTexture.source,frame:new O(e*64,0,64,64)})}update(e,t=0){let s=this.level;if(this.value>=30&&this.level<3?(this.level=3,this.generationRate=3.3):this.value>=15&&this.level<2?(this.level=2,this.generationRate=2.2):this.value<15&&(this.level=1,this.generationRate=1.1),this.maxConnections=this.level,this.owner!=="neutral"&&this.value<this.capacity){this.timer+=e;let r=this.generationRate;this.owner==="player"&&(r*=1.1),this.timer>=1/r&&(this.value++,this.timer=0)}this.updateVisuals(s,t)}updateVisuals(e,t){this.text.text=Math.floor(this.value),this.graphics.clear(),this.owner!=="neutral"?(this.graphics.circle(0,0,this.radius+5+this.level*2),this.graphics.fill({color:this.colors[this.owner],alpha:.3})):(this.graphics.circle(0,0,this.radius),this.graphics.fill({color:1710618}),this.graphics.stroke({width:3,color:this.colors[this.owner]})),this.sprite.texture=this.getTextureFrame();const s=4,r=10,a=this.radius+15;let o=-((this.maxConnections-1)*r)/2;for(let n=0;n<this.maxConnections;n++)this.graphics.circle(o+n*r,a,s),n<t?this.graphics.fill({color:this.colors[this.owner]||16777215}):(this.graphics.fill({color:0}),this.graphics.stroke({width:1,color:this.colors[this.owner]||16777215}))}contains(e,t){const s=this.x-e,r=this.y-t;return s*s+r*r<=this.radius*this.radius}destroy(){this.container.destroy({children:!0})}}class J{constructor(e,t,s,r,a,o){this.x=e,this.y=t,this.target=s,this.owner=r,this.source=a,this.speed=150,this.active=!0,this.radius=4,this.container=new T,this.container.x=e,this.container.y=t;let n=Math.floor(Math.random()*10)+9;this.sprite=new X(new v({source:o.source,frame:new O(n*64,0,64,64)})),this.sprite.anchor.set(.5),this.sprite.width=24,this.sprite.height=24,this.owner==="player"?this.sprite.tint=65535:this.sprite.tint=16711935,this.shadow=new X(new v({source:o.source,frame:new O(n*64,0,64,64)})),this.shadow.anchor.set(.5),this.shadow.width=24,this.shadow.height=24,this.shadow.tint=0,this.shadow.alpha=.6,this.shadow.position.set(3,3),this.container.addChild(this.shadow),this.container.addChild(this.sprite)}update(e,t){if(!this.active)return;const s=this.target.x-this.x,r=this.target.y-this.y,a=Math.sqrt(s*s+r*r);if(a<5){this.hitTarget(t);return}const o=this.speed*e;this.x+=s/a*o,this.y+=r/a*o,this.container.x=this.x,this.container.y=this.y}hitTarget(e){if(this.active=!1,this.target.owner===this.owner){if(this.target.value<this.target.capacity)this.target.value++;else if(e){const t=e.connections.filter(s=>s.from===this.target);if(t.length>0){const s=t[Math.floor(Math.random()*t.length)],r=new J(this.target.x,this.target.y,s.to,this.owner,this.target,e.spritesTexture);e.units.push(r),e.unitLayer.addChild(r.container)}}}else this.target.value--,this.target.value<=0&&(this.target.owner=this.owner,this.target.value=Math.abs(this.target.value))}destroy(){this.container.destroy({children:!0})}}class It{constructor(e,t,s){this.from=e,this.to=t,this.timer=0,this.rate=1,this.growthTimer=0,this.growthDuration=.5,this.fullyGrown=!1,this.container=new T;const r=this.to.x-this.from.x,a=this.to.y-this.from.y;this.distance=Math.sqrt(r*r+a*a),this.angle=Math.atan2(a,r),this.container.x=this.from.x,this.container.y=this.from.y,this.container.rotation=this.angle,this.sprite=new _t({texture:s,width:0,height:32}),this.sprite.anchor.set(0,.5),this.sprite.tint=this.from.owner==="enemy"?16729156:65437,this.container.addChild(this.sprite)}update(e,t){const r=t.connections.find(a=>a.from===this.to&&a.to===this.from)?this.distance/2:this.distance;if(this.fullyGrown?this.sprite.width=r:(this.growthTimer+=e,this.growthTimer>=this.growthDuration&&(this.fullyGrown=!0,this.growthTimer=this.growthDuration),this.sprite.width=Math.min(this.growthTimer/this.growthDuration*this.distance,r)),this.sprite.tilePosition.x+=50*e,this.fullyGrown&&this.from.value>=1){this.timer+=e;const a=this.from.generationRate/2;if(this.timer>=1/a){this.timer=0,this.from.value--;const o=new J(this.from.x,this.from.y,this.to,this.from.owner,this.from,t.spritesTexture);t.units.push(o),t.unitLayer.addChild(o.container)}}}destroy(){this.container.destroy({children:!0})}}class St{constructor(){this.app=new Se,this.nodes=[],this.units=[],this.connections=[],this.isDragging=!1,this.isCutting=!1,this.dragStartNode=null,this.cutStart={x:0,y:0},this.mouseX=0,this.mouseY=0,this.ui={playerScore:document.getElementById("player-score"),enemyScore:document.getElementById("enemy-score"),scoreBarFill:document.getElementById("score-bar-fill"),victoryScreen:document.getElementById("victory-screen")},this.lastPlayerScore=-1,this.lastEnemyScore=-1,this.gameOverTriggered=!1,this.gameOverTimer=0,this.paused=!1}async init(e){const t=window.innerWidth<768,s={canvas:e,backgroundColor:328976,antialias:!0,resolution:window.devicePixelRatio||1,autoDensity:!0};t?(s.width=window.innerWidth*.9,s.height=window.innerHeight*.9):s.resizeTo=window,await this.app.init(s),this.spritesTexture=await E.load(bt),this.wireTexture=await E.load(Tt),this.connectionLayer=new T,this.nodeLayer=new T,this.unitLayer=new T,this.uiLayer=new T,this.app.stage.addChild(this.connectionLayer),this.app.stage.addChild(this.unitLayer),this.app.stage.addChild(this.nodeLayer),this.app.stage.addChild(this.uiLayer),this.app.stage.eventMode="static",this.app.stage.hitArea=this.app.screen,this.app.stage.on("pointerdown",r=>this.handleInputStart(r)),this.app.stage.on("pointermove",r=>this.handleInputMove(r)),this.app.stage.on("pointerup",r=>this.handleInputEnd(r)),this.app.stage.on("pointerupoutside",r=>this.handleInputEnd(r)),this.dragGraphics=new ce,this.uiLayer.addChild(this.dragGraphics),console.log("Game initialized with PixiJS"),this.app.ticker.add(r=>{this.update(r.deltaTime/60)})}generateLevel(){this.nodes.forEach(n=>n.destroy()),this.units.forEach(n=>n.destroy()),this.connections.forEach(n=>n.destroy()),this.nodes=[],this.units=[],this.connections=[],this.gameOverTriggered=!1,this.gameOverTimer=0,this.paused=!1;const e=this.app.screen.width<768,t=Math.floor(Math.random()*6)+5,s=e?50:100,r=e?100:150,a=this.app.screen.width,o=this.app.screen.height;console.log(`Target Node Count: ${t}, Canvas: ${a}x${o}, Mobile: ${e}`);for(let n=0;n<t;n++){let h=!1,c,f,l=0;for(;!h&&l<100;){c=s+Math.random()*(a-s*2),f=s+Math.random()*(o-s*2),h=!0;for(const d of this.nodes){const p=d.x-c,g=d.y-f;if(Math.sqrt(p*p+g*g)<r){h=!1;break}}l++}if(h){let d="neutral";n===0&&(d="player"),n===1&&(d="enemy");const p=new Et(c,f,d,this.spritesTexture);(d==="player"||d==="enemy")&&(p.value=Math.floor(Math.random()*11)+20),e&&p.container.scale.set(.75),this.nodes.push(p),this.nodeLayer.addChild(p.container)}else console.warn("Failed to place node after 100 attempts")}}update(e){if(!this.paused){this.nodes.forEach(t=>{if(t.owner!==t.lastOwner){if(t.lastOwner==="player"&&t.owner==="enemy"||t.lastOwner==="enemy"&&t.owner==="player")for(let r=this.connections.length-1;r>=0;r--){const a=this.connections[r];a.from===t&&(a.destroy(),this.connections.splice(r,1))}t.lastOwner=t.owner}const s=this.connections.filter(r=>r.from===t).length;t.update(e,s)}),this.connections.forEach(t=>t.update(e,this)),this.units.forEach(t=>t.update(e,this)),this.updateAI(e);for(let t=this.units.length-1;t>=0;t--)this.units[t].active||(this.units[t].destroy(),this.units.splice(t,1));for(let t=this.connections.length-1;t>=0;t--)this.connections[t].from.owner==="neutral"&&(this.connections[t].destroy(),this.connections.splice(t,1));this.updateScoreUI(),this.checkWinCondition(e),this.drawDragUI()}}drawDragUI(){this.dragGraphics.clear(),this.isDragging&&this.dragStartNode?(this.dragGraphics.moveTo(this.dragStartNode.x,this.dragStartNode.y),this.dragGraphics.lineTo(this.mouseX,this.mouseY),this.dragGraphics.stroke({width:2,color:16777215,alpha:.5,dash:[5,5]})):this.isCutting&&(this.dragGraphics.moveTo(this.cutStart.x,this.cutStart.y),this.dragGraphics.lineTo(this.mouseX,this.mouseY),this.dragGraphics.stroke({width:2,color:16711680}))}checkWinCondition(e){if(this.gameOverTriggered){this.gameOverTimer+=e,this.gameOverTimer>5&&(this.paused=!0);return}let t=0,s=0;if(this.nodes.forEach(r=>{r.owner==="enemy"&&(t+=Math.floor(r.value)),r.owner==="player"&&(s+=Math.floor(r.value))}),this.units.forEach(r=>{r.owner==="enemy"&&t++,r.owner==="player"&&s++}),t===0)this.gameOverTriggered=!0,this.ui.victoryScreen&&(this.ui.victoryScreen.style.display="flex");else if(s===0){this.gameOverTriggered=!0;const r=document.getElementById("defeat-screen");r&&(r.style.display="flex")}}updateScoreUI(){let e=0,t=0;if(this.nodes.forEach(s=>{s.owner==="player"&&(e+=Math.floor(s.value)),s.owner==="enemy"&&(t+=Math.floor(s.value))}),this.units.forEach(s=>{s.owner==="player"&&e++,s.owner==="enemy"&&t++}),(e!==this.lastPlayerScore||t!==this.lastEnemyScore)&&(this.lastPlayerScore=e,this.lastEnemyScore=t,this.ui.playerScore&&(this.ui.playerScore.innerText=e),this.ui.enemyScore&&(this.ui.enemyScore.innerText=t),this.ui.scoreBarFill)){const s=e+t,r=s>0?e/s*100:50;this.ui.scoreBarFill.style.width=`${r}%`}}handleInputStart(e){const t=e.global.x,s=e.global.y,r=this.nodes.find(a=>a.contains(t,s));r&&r.owner==="player"?(this.isDragging=!0,this.dragStartNode=r):(this.isCutting=!0,this.cutStart={x:t,y:s},this.mouseX=t,this.mouseY=s)}handleInputMove(e){this.mouseX=e.global.x,this.mouseY=e.global.y}handleInputEnd(e){const t=e.global.x,s=e.global.y;if(this.isDragging&&this.dragStartNode){const r=this.nodes.find(a=>a.contains(t,s));r&&r!==this.dragStartNode&&this.createConnection(this.dragStartNode,r)}else this.isCutting&&this.connections.filter(a=>a.from.owner==="enemy"?!1:this.linesIntersect(this.cutStart,{x:this.mouseX,y:this.mouseY},a.from,a.to)).forEach(a=>{this.units.forEach(n=>{n.source===a.from&&n.target===a.to&&n.active&&n.hitTarget()}),a.destroy();const o=this.connections.indexOf(a);o>-1&&this.connections.splice(o,1)});this.isDragging=!1,this.isCutting=!1,this.dragStartNode=null}createConnection(e,t){if(this.connections.find(n=>n.from===e&&n.to===t)){console.log("Connection rejected: Already exists");return}const r=this.connections.find(n=>n.from===t&&n.to===e),a=this.connections.filter(n=>n.from===e).length;if(a>=e.maxConnections){console.log(`Connection rejected: Max connections reached (${a}/${e.maxConnections})`);return}r&&e.owner===t.owner&&(r.destroy(),this.connections=this.connections.filter(n=>n!==r));const o=new It(e,t,this.wireTexture);this.connections.push(o),this.connectionLayer.addChild(o.container)}linesIntersect(e,t,s,r){const a=(t.x-e.x)*(r.y-s.y)-(r.x-s.x)*(t.y-e.y);if(a===0)return!1;const o=((r.y-s.y)*(r.x-e.x)+(s.x-r.x)*(r.y-e.y))/a,n=((e.y-t.y)*(r.x-e.x)+(t.x-e.x)*(r.y-e.y))/a;return 0<o&&o<1&&0<n&&n<1}updateAI(e){if(this.aiTimer=(this.aiTimer||0)+e,this.aiTimer<3)return;this.aiTimer=0,this.nodes.filter(s=>s.owner==="enemy").forEach(s=>{if(this.connections.filter(h=>h.from===s).length>=s.maxConnections)return;let a=this.nodes.filter(h=>h!==s);a=a.filter(h=>!this.connections.some(c=>c.from===s&&c.to===h));let o=null;const n=a.filter(h=>h.owner==="neutral");if(n.length>0&&(o=n[Math.floor(Math.random()*n.length)]),!o){const c=a.filter(f=>f.owner==="player").filter(f=>s.value>f.value);c.length>0&&(o=c[Math.floor(Math.random()*c.length)])}o&&this.createConnection(s,o)})}}const ye="v1.0.0";document.getElementById("version").innerText=ye+" (PixiJS)";console.log("Hacking Wars "+ye+" (PixiJS)");const xe=document.createElement("canvas");document.body.appendChild(xe);const ne=new St;ne.init(xe).then(()=>{ne.generateLevel()});
