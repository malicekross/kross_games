import"./modulepreload-polyfill-B5Qt9EMX.js";const v="/kross_games/assets/sprites-ClHaEWzu.svg",w="data:image/svg+xml,%3csvg%20width='96'%20height='32'%20viewBox='0%200%2096%2032'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3cstyle%3e%20.neon-green%20{%20fill:%20%2300FF00;%20}%20%3c/style%3e%3crect%20id='p'%20width='2'%20height='2'%20class='neon-green'/%3e%3c/defs%3e%3cg%20id='frame1'%3e%3cuse%20href='%23p'%20x='0'%20y='14'/%3e%3cuse%20href='%23p'%20x='2'%20y='14'/%3e%3cuse%20href='%23p'%20x='0'%20y='16'/%3e%3cuse%20href='%23p'%20x='2'%20y='16'/%3e%3cuse%20href='%23p'%20x='4'%20y='12'/%3e%3cuse%20href='%23p'%20x='6'%20y='12'/%3e%3cuse%20href='%23p'%20x='4'%20y='14'/%3e%3cuse%20href='%23p'%20x='6'%20y='14'/%3e%3cuse%20href='%23p'%20x='8'%20y='10'/%3e%3cuse%20href='%23p'%20x='10'%20y='10'/%3e%3cuse%20href='%23p'%20x='8'%20y='12'/%3e%3cuse%20href='%23p'%20x='10'%20y='12'/%3e%3cuse%20href='%23p'%20x='12'%20y='12'/%3e%3cuse%20href='%23p'%20x='14'%20y='12'/%3e%3cuse%20href='%23p'%20x='12'%20y='14'/%3e%3cuse%20href='%23p'%20x='14'%20y='14'/%3e%3cuse%20href='%23p'%20x='16'%20y='14'/%3e%3cuse%20href='%23p'%20x='18'%20y='14'/%3e%3cuse%20href='%23p'%20x='16'%20y='16'/%3e%3cuse%20href='%23p'%20x='18'%20y='16'/%3e%3cuse%20href='%23p'%20x='20'%20y='16'/%3e%3cuse%20href='%23p'%20x='22'%20y='16'/%3e%3cuse%20href='%23p'%20x='20'%20y='18'/%3e%3cuse%20href='%23p'%20x='22'%20y='18'/%3e%3cuse%20href='%23p'%20x='24'%20y='18'/%3e%3cuse%20href='%23p'%20x='26'%20y='18'/%3e%3cuse%20href='%23p'%20x='24'%20y='20'/%3e%3cuse%20href='%23p'%20x='26'%20y='20'/%3e%3cuse%20href='%23p'%20x='28'%20y='16'/%3e%3cuse%20href='%23p'%20x='30'%20y='16'/%3e%3cuse%20href='%23p'%20x='28'%20y='18'/%3e%3cuse%20href='%23p'%20x='30'%20y='18'/%3e%3c/g%3e%3cg%20id='frame2'%20transform='translate(32,%200)'%3e%3cuse%20href='%23p'%20x='0'%20y='18'/%3e%3cuse%20href='%23p'%20x='2'%20y='18'/%3e%3cuse%20href='%23p'%20x='0'%20y='20'/%3e%3cuse%20href='%23p'%20x='2'%20y='20'/%3e%3cuse%20href='%23p'%20x='4'%20y='16'/%3e%3cuse%20href='%23p'%20x='6'%20y='16'/%3e%3cuse%20href='%23p'%20x='4'%20y='18'/%3e%3cuse%20href='%23p'%20x='6'%20y='18'/%3e%3cuse%20href='%23p'%20x='8'%20y='14'/%3e%3cuse%20href='%23p'%20x='10'%20y='14'/%3e%3cuse%20href='%23p'%20x='8'%20y='16'/%3e%3cuse%20href='%23p'%20x='10'%20y='16'/%3e%3cuse%20href='%23p'%20x='12'%20y='12'/%3e%3cuse%20href='%23p'%20x='14'%20y='12'/%3e%3cuse%20href='%23p'%20x='12'%20y='14'/%3e%3cuse%20href='%23p'%20x='14'%20y='14'/%3e%3cuse%20href='%23p'%20x='16'%20y='10'/%3e%3cuse%20href='%23p'%20x='18'%20y='10'/%3e%3cuse%20href='%23p'%20x='16'%20y='12'/%3e%3cuse%20href='%23p'%20x='18'%20y='12'/%3e%3cuse%20href='%23p'%20x='20'%20y='12'/%3e%3cuse%20href='%23p'%20x='22'%20y='12'/%3e%3cuse%20href='%23p'%20x='20'%20y='14'/%3e%3cuse%20href='%23p'%20x='22'%20y='14'/%3e%3cuse%20href='%23p'%20x='24'%20y='14'/%3e%3cuse%20href='%23p'%20x='26'%20y='14'/%3e%3cuse%20href='%23p'%20x='24'%20y='16'/%3e%3cuse%20href='%23p'%20x='26'%20y='16'/%3e%3cuse%20href='%23p'%20x='28'%20y='16'/%3e%3cuse%20href='%23p'%20x='30'%20y='16'/%3e%3cuse%20href='%23p'%20x='28'%20y='18'/%3e%3cuse%20href='%23p'%20x='30'%20y='18'/%3e%3c/g%3e%3cg%20id='frame3'%20transform='translate(64,%200)'%3e%3cuse%20href='%23p'%20x='0'%20y='12'/%3e%3cuse%20href='%23p'%20x='2'%20y='12'/%3e%3cuse%20href='%23p'%20x='0'%20y='14'/%3e%3cuse%20href='%23p'%20x='2'%20y='14'/%3e%3cuse%20href='%23p'%20x='4'%20y='14'/%3e%3cuse%20href='%23p'%20x='6'%20y='14'/%3e%3cuse%20href='%23p'%20x='4'%20y='16'/%3e%3cuse%20href='%23p'%20x='6'%20y='16'/%3e%3cuse%20href='%23p'%20x='8'%20y='16'/%3e%3cuse%20href='%23p'%20x='10'%20y='16'/%3e%3cuse%20href='%23p'%20x='8'%20y='18'/%3e%3cuse%20href='%23p'%20x='10'%20y='18'/%3e%3cuse%20href='%23p'%20x='12'%20y='18'/%3e%3cuse%20href='%23p'%20x='14'%20y='18'/%3e%3cuse%20href='%23p'%20x='12'%20y='20'/%3e%3cuse%20href='%23p'%20x='14'%20y='20'/%3e%3cuse%20href='%23p'%20x='16'%20y='16'/%3e%3cuse%20href='%23p'%20x='18'%20y='16'/%3e%3cuse%20href='%23p'%20x='16'%20y='18'/%3e%3cuse%20href='%23p'%20x='18'%20y='18'/%3e%3cuse%20href='%23p'%20x='20'%20y='14'/%3e%3cuse%20href='%23p'%20x='22'%20y='14'/%3e%3cuse%20href='%23p'%20x='20'%20y='16'/%3e%3cuse%20href='%23p'%20x='22'%20y='16'/%3e%3cuse%20href='%23p'%20x='24'%20y='12'/%3e%3cuse%20href='%23p'%20x='26'%20y='12'/%3e%3cuse%20href='%23p'%20x='24'%20y='14'/%3e%3cuse%20href='%23p'%20x='26'%20y='14'/%3e%3cuse%20href='%23p'%20x='28'%20y='10'/%3e%3cuse%20href='%23p'%20x='30'%20y='10'/%3e%3cuse%20href='%23p'%20x='28'%20y='12'/%3e%3cuse%20href='%23p'%20x='30'%20y='12'/%3e%3c/g%3e%3c/svg%3e";class S{constructor(e,t,s="neutral"){this.x=e,this.y=t,this.owner=s,this.value=10,this.capacity=60,this.radius=30,this.level=1,this.generationRate=1.1,this.maxConnections=1,this.timer=0,this.colors={player:"#00ff9d",enemy:"#ff3333",neutral:"#888888"}}update(e){this.value>=30&&this.level<3?(this.level=3,this.generationRate=3.3):this.value>=15&&this.level<2?(this.level=2,this.generationRate=2.2):this.value<15&&(this.level=1,this.generationRate=1.1),this.maxConnections=this.level,this.owner!=="neutral"&&this.value<this.capacity&&(this.timer+=e,this.timer>=1/this.generationRate&&(this.value++,this.timer=0))}draw(e,t,s,i=0){if(s){let r=6;this.owner==="player"?r=this.level-1:this.owner==="enemy"&&(r=3+(this.level-1));const h=this.radius*2.5;e.drawImage(t,r*64,0,64,64,this.x-h/2,this.y-h/2,h,h),this.owner!=="neutral"&&(e.globalAlpha=.3,e.fillStyle=this.colors[this.owner],e.beginPath(),e.arc(this.x,this.y,this.radius+5+this.level*2,0,Math.PI*2),e.fill(),e.globalAlpha=1)}else e.beginPath(),e.arc(this.x,this.y,this.radius,0,Math.PI*2),e.fillStyle="#1a1a1a",e.fill(),e.lineWidth=3,e.strokeStyle=this.colors[this.owner],e.stroke();if(e.font='bold 24px "Courier New", monospace',e.textAlign="center",e.textBaseline="middle",e.lineWidth=4,e.strokeStyle="#000000",e.strokeText(Math.floor(this.value),this.x,this.y),e.fillStyle="#ffffff",e.fillText(Math.floor(this.value),this.x,this.y),this.owner==="player"){const n=this.x-(this.maxConnections-1)*12/2,u=this.y+this.radius+15;for(let o=0;o<this.maxConnections;o++)e.beginPath(),e.arc(n+o*12,u,4,0,Math.PI*2),o<i&&(e.fillStyle="#00ff9d",e.fill()),e.strokeStyle="#00ff9d",e.lineWidth=1.5,e.stroke()}}contains(e,t){const s=this.x-e,i=this.y-t;return s*s+i*i<=this.radius*this.radius}}class E{constructor(e,t,s,i,r){this.x=e,this.y=t,this.target=s,this.owner=i,this.source=r,this.speed=100,this.active=!0,this.radius=4,this.colors={player:"#00ff9d",enemy:"#ff3333"}}update(e,t){if(!this.active)return;const s=this.target.x-this.x,i=this.target.y-this.y,r=Math.sqrt(s*s+i*i);if(r<5){this.hitTarget(t);return}const h=this.speed*e;this.x+=s/r*h,this.y+=i/r*h}draw(e,t,s){if(s){let i=7;this.owner==="enemy"&&(i=8);const r=this.radius*4;e.drawImage(t,i*64,0,64,64,this.x-r/2,this.y-r/2,r,r)}else e.beginPath(),e.arc(this.x,this.y,this.radius,0,Math.PI*2),e.fillStyle=this.colors[this.owner],e.fill(),e.fill()}hitTarget(e){if(this.active=!1,this.target.owner===this.owner){if(this.target.value<this.target.capacity)this.target.value++;else if(e){const t=e.connections.filter(s=>s.from===this.target);if(t.length>0){const s=t[Math.floor(Math.random()*t.length)];e.units.push(new this.constructor(this.target.x,this.target.y,s.to,this.owner,this.target))}}}else this.target.value--,this.target.value<=0&&(this.target.owner=this.owner,this.target.value=Math.abs(this.target.value))}}class C{constructor(e,t){this.from=e,this.to=t,this.timer=0,this.rate=1,this.growthTimer=0,this.growthDuration=.5,this.fullyGrown=!1}update(e,t){if(this.fullyGrown||(this.growthTimer+=e,this.growthTimer>=this.growthDuration&&(this.fullyGrown=!0,this.growthTimer=this.growthDuration)),this.fullyGrown&&this.from.value>=1){this.timer+=e;const s=this.from.generationRate/2;this.timer>=1/s&&(this.timer=0,this.from.value--,t.units.push(new E(this.from.x,this.from.y,this.to,this.from.owner,this.from)))}}draw(e,t){if(t.wireSpriteLoaded){const s=this.to.x-this.from.x,i=this.to.y-this.from.y,r=Math.sqrt(s*s+i*i),h=Math.atan2(i,s),n=this.fullyGrown?r:this.growthTimer/this.growthDuration*r;e.save(),e.translate(this.from.x,this.from.y),e.rotate(h);const o=performance.now()/1e3*-50%96,a=96,l=32;for(let p=-1;;p++){let c=p*a-o,d=a,g=0,f=a;if(!(c+d<0)){if(c<0&&(g=-c,f=d+c,c=0),c+f>n&&(f=n-c),c>=n)break;f>0&&e.drawImage(t.wireSprite,g,0,f,l,c,-l/2,f,l)}}e.restore()}else e.beginPath(),e.moveTo(this.from.x,this.from.y),e.lineTo(this.to.x,this.to.y),e.strokeStyle="#00ff9d",e.lineWidth=2,e.stroke()}}class I{constructor(e){this.canvas=e,this.ctx=e.getContext("2d"),this.nodes=[],this.units=[],this.connections=[],this.lastTime=0,this.resize(),window.addEventListener("resize",()=>this.resize()),this.isDragging=!1,this.isCutting=!1,this.dragStartNode=null,this.cutStart={x:0,y:0},this.mouseX=0,this.mouseY=0,this.canvas.addEventListener("mousedown",t=>this.handleInputStart(t)),this.canvas.addEventListener("mousemove",t=>this.handleInputMove(t)),this.canvas.addEventListener("mouseup",t=>this.handleInputEnd(t)),this.canvas.addEventListener("touchstart",t=>{t.preventDefault(),this.handleInputStart(t.touches[0])},{passive:!1}),this.canvas.addEventListener("touchmove",t=>{t.preventDefault(),this.handleInputMove(t.touches[0])},{passive:!1}),this.canvas.addEventListener("touchend",t=>{t.preventDefault(),this.handleInputEnd(t.changedTouches[0])},{passive:!1}),this.sprites=new Image,this.sprites.src=v,this.spritesLoaded=!1,this.sprites.onload=()=>{this.spritesLoaded=!0},this.sprites.onerror=t=>{console.error("Error loading sprites")},this.wireSprite=new Image,this.wireSprite.src=w,this.wireSpriteLoaded=!1,this.wireSprite.onload=()=>{this.wireSpriteLoaded=!0},this.wireSprite.onerror=t=>{console.error("Error loading wire sprite")},this.ui={playerScore:document.getElementById("player-score"),enemyScore:document.getElementById("enemy-score"),scoreBarFill:document.getElementById("score-bar-fill"),victoryScreen:document.getElementById("victory-screen")},this.lastPlayerScore=-1,this.lastEnemyScore=-1,console.log("Game initialized")}generateLevel(){this.nodes=[],this.units=[],this.connections=[];const e=Math.floor(Math.random()*6)+5,t=100,s=150;console.log(`Target Node Count: ${e}, Canvas: ${this.canvas.width}x${this.canvas.height}`);for(let i=0;i<e;i++){let r=!1,h,n,u=0;for(;!r&&u<100;){h=t+Math.random()*(this.canvas.width-t*2),n=t+Math.random()*(this.canvas.height-t*2),r=!0;for(const o of this.nodes){const a=o.x-h,l=o.y-n;if(Math.sqrt(a*a+l*l)<s){r=!1;break}}u++}if(r){let o="neutral";i===0&&(o="player"),i===1&&(o="enemy");const a=new S(h,n,o);o==="player"&&(a.value=10),this.nodes.push(a)}else console.warn("Failed to place node after 100 attempts")}console.log(`Total Nodes: ${this.nodes.length}`)}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,console.log(`Resized Canvas to ${this.canvas.width}x${this.canvas.height}`)}start(){this.lastTime=performance.now(),requestAnimationFrame(e=>this.loop(e))}loop(e){let t=(e-this.lastTime)/1e3;this.lastTime=e,t>.1&&(t=.1),this.update(t),this.draw(),requestAnimationFrame(s=>this.loop(s))}update(e){this.nodes.forEach(t=>t.update(e)),this.connections.forEach(t=>t.update(e,this)),this.units.forEach(t=>t.update(e,this)),this.units=this.units.filter(t=>t.active),this.connections=this.connections.filter(t=>t.from.owner==="player"),this.updateScoreUI(),this.checkWinCondition()}checkWinCondition(){let e=0;this.nodes.forEach(t=>{t.owner==="enemy"&&(e+=Math.floor(t.value))}),this.units.forEach(t=>{t.owner==="enemy"&&e++}),e===0&&this.ui.victoryScreen&&(this.ui.victoryScreen.style.display="flex")}updateScoreUI(){let e=0,t=0;if(this.nodes.forEach(s=>{s.owner==="player"&&(e+=Math.floor(s.value)),s.owner==="enemy"&&(t+=Math.floor(s.value))}),this.units.forEach(s=>{s.owner==="player"&&e++,s.owner==="enemy"&&t++}),(e!==this.lastPlayerScore||t!==this.lastEnemyScore)&&(this.lastPlayerScore=e,this.lastEnemyScore=t,this.ui.playerScore&&(this.ui.playerScore.innerText=e),this.ui.enemyScore&&(this.ui.enemyScore.innerText=t),this.ui.scoreBarFill)){const s=e+t,i=s>0?e/s*100:50;this.ui.scoreBarFill.style.width=`${i}%`}}draw(){this.ctx.fillStyle="#050510",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.connections.forEach(e=>e.draw(this.ctx,this)),this.isDragging&&this.dragStartNode&&(this.ctx.beginPath(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.5)",this.ctx.setLineDash([5,5]),this.ctx.moveTo(this.dragStartNode.x,this.dragStartNode.y),this.ctx.lineTo(this.mouseX,this.mouseY),this.ctx.stroke(),this.ctx.setLineDash([])),this.isCutting&&(this.ctx.beginPath(),this.ctx.strokeStyle="#ff0000",this.ctx.lineWidth=2,this.ctx.moveTo(this.cutStart.x,this.cutStart.y),this.ctx.lineTo(this.mouseX,this.mouseY),this.ctx.stroke()),this.nodes.forEach(e=>{const t=this.connections.filter(s=>s.from===e).length;e.draw(this.ctx,this.sprites,this.spritesLoaded,t)}),this.units.forEach(e=>e.draw(this.ctx,this.sprites,this.spritesLoaded))}handleInputStart(e){const t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top,r=this.nodes.find(h=>h.contains(s,i));r&&r.owner==="player"?(this.isDragging=!0,this.dragStartNode=r):(this.isCutting=!0,this.cutStart={x:s,y:i},this.mouseX=s,this.mouseY=i)}handleInputMove(e){const t=this.canvas.getBoundingClientRect();this.mouseX=e.clientX-t.left,this.mouseY=e.clientY-t.top}handleInputEnd(e){const t=this.canvas.getBoundingClientRect(),s=e.clientX-t.left,i=e.clientY-t.top;if(this.isDragging&&this.dragStartNode){const r=this.nodes.find(h=>h.contains(s,i));r&&r!==this.dragStartNode&&this.createConnection(this.dragStartNode,r)}else if(this.isCutting){const r=this.connections.filter(h=>this.linesIntersect(this.cutStart,{x:this.mouseX,y:this.mouseY},h.from,h.to));this.connections=this.connections.filter(h=>!r.includes(h)),r.forEach(h=>{this.units.forEach(n=>{n.source===h.from&&n.target===h.to&&n.active&&n.hitTarget()})})}this.isDragging=!1,this.isCutting=!1,this.dragStartNode=null}createConnection(e,t){if(this.connections.find(h=>h.from===e&&h.to===t))return;const i=this.connections.find(h=>h.from===t&&h.to===e);this.connections.filter(h=>h.from===e).length>=e.maxConnections||(i&&(this.connections=this.connections.filter(h=>h!==i)),this.connections.push(new C(e,t)))}linesIntersect(e,t,s,i){const r=(t.x-e.x)*(i.y-s.y)-(i.x-s.x)*(t.y-e.y);if(r===0)return!1;const h=((i.y-s.y)*(i.x-e.x)+(s.x-i.x)*(i.y-e.y))/r,n=((e.y-t.y)*(i.x-e.x)+(t.x-e.x)*(i.y-e.y))/r;return 0<h&&h<1&&0<n&&n<1}}const x=document.createElement("canvas");document.body.appendChild(x);const m=new I(x);m.generateLevel();m.start();
