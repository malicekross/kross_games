const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Connection-DltbC3uH.js","assets/modulepreload-polyfill-B5Qt9EMX.js"])))=>i.map(i=>d[i]);
import"./modulepreload-polyfill-B5Qt9EMX.js";const y="modulepreload",v=function(u){return"/kross_games/"+u},f={},w=function(t,e,n){let i=Promise.resolve();if(e&&e.length>0){let d=function(r){return Promise.all(r.map(h=>Promise.resolve(h).then(l=>({status:"fulfilled",value:l}),l=>({status:"rejected",reason:l}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),a=s?.nonce||s?.getAttribute("nonce");i=d(e.map(r=>{if(r=v(r),r in f)return;f[r]=!0;const h=r.endsWith(".css"),l=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${r}"]${l}`))return;const c=document.createElement("link");if(c.rel=h?"stylesheet":y,h||(c.as="script"),c.crossOrigin="",c.href=r,a&&c.setAttribute("nonce",a),document.head.appendChild(c),h)return new Promise((g,p)=>{c.addEventListener("load",g),c.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${r}`)))})}))}function o(s){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s}return i.then(s=>{for(const a of s||[])a.status==="rejected"&&o(a.reason);return t().catch(o)})},S="/kross_games/assets/sprites-ClHaEWzu.svg",x="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%2064%2032'%20width='64'%20height='32'%3e%3cpath%20d='M0,16%20Q16,0%2032,16%20T64,16'%20fill='none'%20stroke='%2300ff9d'%20stroke-width='4'%20stroke-linecap='round'/%3e%3c/svg%3e";class E{constructor(t,e,n="neutral"){this.x=t,this.y=e,this.owner=n,this.value=10,this.capacity=50,this.radius=30,this.level=1,this.generationRate=1.1,this.maxConnections=1,this.timer=0,this.colors={player:"#00ff9d",enemy:"#ff3333",neutral:"#888888"}}update(t){this.value>=30&&this.level<3?(this.level=3,this.generationRate=3.3):this.value>=15&&this.level<2?(this.level=2,this.generationRate=2.2):this.value<15&&(this.level=1,this.generationRate=1.1),this.maxConnections=this.level,this.owner!=="neutral"&&this.value<this.capacity&&(this.timer+=t,this.timer>=1/this.generationRate&&(this.value++,this.timer=0))}draw(t,e,n,i=0){if(n){let o=6;this.owner==="player"?o=this.level-1:this.owner==="enemy"&&(o=3+(this.level-1));const s=this.radius*2.5;t.drawImage(e,o*64,0,64,64,this.x-s/2,this.y-s/2,s,s),this.owner!=="neutral"&&(t.shadowBlur=10+this.level*5,t.shadowColor=this.colors[this.owner],t.globalCompositeOperation="lighter",t.drawImage(e,o*64,0,64,64,this.x-s/2,this.y-s/2,s,s),t.globalCompositeOperation="source-over",t.shadowBlur=0)}else t.beginPath(),t.arc(this.x,this.y,this.radius,0,Math.PI*2),t.fillStyle="#1a1a1a",t.fill(),t.lineWidth=3,t.strokeStyle=this.colors[this.owner],t.stroke();if(t.font='bold 24px "Courier New", monospace',t.textAlign="center",t.textBaseline="middle",t.shadowBlur=4,t.shadowColor="#000000",t.lineWidth=4,t.strokeStyle="#000000",t.strokeText(Math.floor(this.value),this.x,this.y),t.shadowBlur=0,t.fillStyle="#ffffff",t.fillText(Math.floor(this.value),this.x,this.y),this.owner==="player"){const a=this.x-(this.maxConnections-1)*12/2,d=this.y+this.radius+15;for(let r=0;r<this.maxConnections;r++)t.beginPath(),t.arc(a+r*12,d,4,0,Math.PI*2),r<i&&(t.fillStyle="#00ff9d",t.fill()),t.strokeStyle="#00ff9d",t.lineWidth=1.5,t.stroke()}}contains(t,e){const n=this.x-t,i=this.y-e;return n*n+i*i<=this.radius*this.radius}}class C{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.nodes=[],this.units=[],this.connections=[],this.lastTime=0,this.resize(),window.addEventListener("resize",()=>this.resize()),this.isDragging=!1,this.isCutting=!1,this.dragStartNode=null,this.cutStart={x:0,y:0},this.mouseX=0,this.mouseY=0,this.canvas.addEventListener("mousedown",e=>this.handleInputStart(e)),this.canvas.addEventListener("mousemove",e=>this.handleInputMove(e)),this.canvas.addEventListener("mouseup",e=>this.handleInputEnd(e)),this.sprites=new Image,this.sprites.src=S,this.spritesLoaded=!1,this.sprites.onload=()=>{this.spritesLoaded=!0},this.wireSprite=new Image,this.wireSprite.src=x,this.wireSpriteLoaded=!1,this.wireSprite.onload=()=>{this.wireSpriteLoaded=!0}}generateLevel(){this.nodes=[],this.units=[],this.connections=[];const t=Math.floor(Math.random()*6)+5,e=100,n=150;for(let i=0;i<t;i++){let o=!1,s,a,d=0;for(;!o&&d<100;){s=e+Math.random()*(this.canvas.width-e*2),a=e+Math.random()*(this.canvas.height-e*2),o=!0;for(const r of this.nodes){const h=r.x-s,l=r.y-a;if(Math.sqrt(h*h+l*l)<n){o=!1;break}}d++}if(o){let r="neutral";i===0&&(r="player"),i===1&&(r="enemy");const h=new E(s,a,r);r==="player"&&(h.value=10),this.nodes.push(h)}}}resize(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight}start(){this.lastTime=performance.now(),requestAnimationFrame(t=>this.loop(t))}loop(t){let e=(t-this.lastTime)/1e3;this.lastTime=t,e>.1&&(e=.1),this.update(e),this.draw(),requestAnimationFrame(n=>this.loop(n))}update(t){this.nodes.forEach(e=>e.update(t)),this.connections.forEach(e=>e.update(t,this)),this.units.forEach(e=>e.update(t)),this.units=this.units.filter(e=>e.active),this.connections=this.connections.filter(e=>e.from.owner==="player"),this.updateScoreUI(),this.checkWinCondition()}checkWinCondition(){let t=0;if(this.nodes.forEach(e=>{e.owner==="enemy"&&(t+=Math.floor(e.value))}),this.units.forEach(e=>{e.owner==="enemy"&&t++}),t===0){const e=document.getElementById("victory-screen");e&&(e.style.display="flex")}}updateScoreUI(){let t=0,e=0;this.nodes.forEach(s=>{s.owner==="player"&&(t+=Math.floor(s.value)),s.owner==="enemy"&&(e+=Math.floor(s.value))}),this.units.forEach(s=>{s.owner==="player"&&t++,s.owner==="enemy"&&e++});const n=document.getElementById("player-score"),i=document.getElementById("enemy-score"),o=document.getElementById("score-bar-fill");if(n&&(n.innerText=t),i&&(i.innerText=e),o){const s=t+e,a=s>0?t/s*100:50;o.style.width=`${a}%`}}draw(){this.ctx.fillStyle="#050510",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.connections.forEach(t=>t.draw(this.ctx)),this.isDragging&&this.dragStartNode&&(this.ctx.beginPath(),this.ctx.strokeStyle="rgba(255, 255, 255, 0.5)",this.ctx.setLineDash([5,5]),this.ctx.moveTo(this.dragStartNode.x,this.dragStartNode.y),this.ctx.lineTo(this.mouseX,this.mouseY),this.ctx.stroke(),this.ctx.setLineDash([])),this.isCutting&&(this.ctx.beginPath(),this.ctx.strokeStyle="#ff0000",this.ctx.lineWidth=2,this.ctx.moveTo(this.cutStart.x,this.cutStart.y),this.ctx.lineTo(this.mouseX,this.mouseY),this.ctx.stroke()),this.nodes.forEach(t=>{const e=this.connections.filter(n=>n.from===t).length;t.draw(this.ctx,this.sprites,this.spritesLoaded,e)}),this.units.forEach(t=>t.draw(this.ctx,this.sprites,this.spritesLoaded))}handleInputStart(t){const e=this.canvas.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,o=this.nodes.find(s=>s.contains(n,i));o&&o.owner==="player"?(this.isDragging=!0,this.dragStartNode=o):(this.isCutting=!0,this.cutStart={x:n,y:i},this.mouseX=n,this.mouseY=i)}handleInputMove(t){const e=this.canvas.getBoundingClientRect();this.mouseX=t.clientX-e.left,this.mouseY=t.clientY-e.top}handleInputEnd(t){if(this.isDragging&&this.dragStartNode){const e=this.canvas.getBoundingClientRect(),n=t.clientX-e.left,i=t.clientY-e.top,o=this.nodes.find(s=>s.contains(n,i));o&&o!==this.dragStartNode&&this.createConnection(this.dragStartNode,o)}else if(this.isCutting){const e=this.connections.filter(n=>this.linesIntersect(this.cutStart,{x:this.mouseX,y:this.mouseY},n.from,n.to));this.connections=this.connections.filter(n=>!e.includes(n)),e.forEach(n=>{this.units.forEach(i=>{i.source===n.from&&i.target===n.to&&i.active&&i.hitTarget()})})}this.isDragging=!1,this.isCutting=!1,this.dragStartNode=null}createConnection(t,e){if(this.connections.find(s=>s.from===t&&s.to===e))return;const i=this.connections.find(s=>s.from===e&&s.to===t);this.connections.filter(s=>s.from===t).length>=t.maxConnections||(i&&(this.connections=this.connections.filter(s=>s!==i)),w(()=>import("./Connection-DltbC3uH.js"),__vite__mapDeps([0,1])).then(s=>{const a=s.Connection;this.connections.push(new a(t,e))}))}linesIntersect(t,e,n,i){const o=(e.x-t.x)*(i.y-n.y)-(i.x-n.x)*(e.y-t.y);if(o===0)return!1;const s=((i.y-n.y)*(i.x-t.x)+(n.x-i.x)*(i.y-t.y))/o,a=((t.y-e.y)*(i.x-t.x)+(e.x-t.x)*(i.y-t.y))/o;return 0<s&&s<1&&0<a&&a<1}}const k=document.getElementById("gameCanvas"),m=new C(k);m.generateLevel();m.start();export{w as _};
